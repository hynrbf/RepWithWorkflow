import{j as b,aa as a,D as l,bz as R,ag as I,af as B,I as $,ac as k,l as g,bE as d,aq as y,b3 as M,aV as A,am as O,A as n,a3 as z,b4 as U,as as f,at as P,au as S,av as w,bd as q,bk as E,az as m,aA as c,o as v,m as x,n as C,w as j,P as X,x as Y,q as h,y as p,J as H,aC as K,aG as W,aH as G,_ as J}from"./index-9d6d511f.js";const Q=b({name:"ARProviders",components:{ARProvidersList:a(()=>m(()=>import("./ARProvidersList-151de5bf.js"),["assets/ARProvidersList-151de5bf.js","assets/index-9d6d511f.js","assets/index-982d5504.css","assets/rejected-grey-icon-2a930ba1.js","assets/ARProvidersList-885b6a8b.css"])),ARProvidersCard:a(()=>m(()=>import("./ARProvidersCard-9db63b39.js"),["assets/ARProvidersCard-9db63b39.js","assets/index-9d6d511f.js","assets/index-982d5504.css","assets/ARProvidersCard-76b401b0.css"])),ARViewProviderModal:a(()=>m(()=>import("./ARViewProviderModal-52688095.js"),["assets/ARViewProviderModal-52688095.js","assets/index-9d6d511f.js","assets/index-982d5504.css","assets/ARViewProviderModal-0d8dc984.css"])),ARProviderFormModal:a(()=>m(()=>import("./ARProviderFormModal-d5c985aa.js"),["assets/ARProviderFormModal-d5c985aa.js","assets/index-9d6d511f.js","assets/index-982d5504.css"])),ARTasksModal:a(()=>m(()=>import("./ARTasksModal-caf7e951.js"),["assets/ARTasksModal-caf7e951.js","assets/ModalComponent.vue_vue_type_script_setup_true_lang-fe9b98ed.js","assets/index-9d6d511f.js","assets/index-982d5504.css","assets/ARTasksModal-73c6f540.css"])),ViewProviderPermissions:a(()=>m(()=>import("./ARViewProviderPermissions-dd0047d5.js"),["assets/ARViewProviderPermissions-dd0047d5.js","assets/index-9d6d511f.js","assets/index-982d5504.css","assets/ViewProviderPermissions-9ee24b6f.css"]))},data(){return{isShowProvidersAsList:!0,isShowProviderViewer:!1,isShowProviderForm:!1,isShowTasksViewer:!1,isShowProviderPermissions:!1,isEditMode:!1,providerName:"<Provider Name>",isLoading:!1,isShowSavingText:!1,isSavingAlertOpened:!1,pageDescription:"",customerService:l.resolve(R.name),userSubmittedChangesService:l.resolve(I.name),fcaService:l.resolve(B.name),helperService:l.resolve($.name),appService:l.resolve(k.name),eventBus:g("$eventBusService"),eventBusFormSaved:g("$eventBusService"),titles:[],isInitializing:!0,updatedProvidersList:[],provider:new d,providerTasks:[],arCustomer:new y,currentArCustomer:void 0,currentArFirmName:"",firmName:"",permissions:[],permissionsCategorized:[],menuItems:[{text:"View Details"},{text:"Edit Details"},{text:"Archive"}],offsetX:0,offsetY:0,isEdit:!1}},computed:{...M(A,["currentArCustomer","currentArFirmName"]),currentProvidersList(){var i,t;if(!this.currentArCustomer)return[];let e=this.currentArCustomer.providers??[];for(const s of e){s.representativeName=`${((i=s.representative)==null?void 0:i.forename)??""} ${((t=s.representative)==null?void 0:t.surname)??""}`;const r={year:"numeric",month:"2-digit",day:"2-digit"},o=this.helperService.convertEpochToDateTime(s.startDate??0);s.startDateString=(o==null?void 0:o.toLocaleDateString(void 0,r))??""}return e}},setup(){const e=O(),{changeLifeCycleName:i}=e;return{changeLifeCycleName:i}},created(){this.arCustomer=this.appService.getCachedCustomerAppointedRepresentative()??new y,this.changeLifeCycleName(n.pageLifeCycleNameCreated)},async mounted(){this.eventBus.emit(n.bottomBarEnableEvent,!0),this.eventBusFormSaved.on(n.formSavedEvent,e=>{this.handleAutoNext(e)}),this.titles=z.getTitles(),this.firmName=this.arCustomer.companyName??"",this.isLoading=!1,this.isInitializing=!1,this.changeLifeCycleName(n.pageLifeCycleNameMounted)},unmounted(){this.eventBus.emit(n.bottomBarEnableEvent,!1),this.eventBusFormSaved.off(n.formSavedEvent),this.isLoading=!1},methods:{...U(A,["updateCustomerArByEmailAsync"]),viewProvider(e){var i,t,s,r;this.isShowProviderViewer=!0,this.provider=this.currentProvidersList.find(o=>o.id===e)??new d,this.provider.details&&(this.provider.details.contactNumberDisplay=`${((i=this.provider.details.contactNumber)==null?void 0:i.dialCode)??""} ${((t=this.provider.details.contactNumber)==null?void 0:t.number)??""}`),this.provider.representative&&(this.provider.representative.contactNumberDisplay=`${((s=this.provider.representative.contactNumber)==null?void 0:s.dialCode)??""} ${((r=this.provider.representative.contactNumber)==null?void 0:r.number)??""}`)},addNewProvider(){this.provider=new d,this.isEditMode=!1,this.showProviderForm()},editProvider(e){this.provider=this.currentProvidersList.find(i=>i.id===e)??new d,this.isEditMode=!0,this.showProviderForm()},viewEditProvider(e){this.provider=this.currentProvidersList.find(i=>i.id===e)??new d,this.showProviderForm()},viewTasks(e,i){this.providerName=e,this.providerTasks=i,this.isShowTasksViewer=!0},handleAutoNext(e){this.isSavingAlertOpened||(f({title:this.$t("common-alert-title"),content:"Providers is incomplete. Are you sure you wish to proceed?",type:P.SAVEDETAILS,confirmButtonText:"Proceed",saveDetailsText:"Complete Now",width:440,onConfirm:async()=>{this.userSubmittedChangesService.hasUserSubmittedChangesToRemoteApi=!0,this.isSavingAlertOpened=!1,S({type:w.SUCCESS,content:this.$t("common-notification-saved"),interval:n.notificationPopupTimeOut}),e&&setTimeout(()=>this.eventBus.emit(n.autoNextEvent),0)},onSaveDetails:()=>{this.isSavingAlertOpened=!1}}),this.isSavingAlertOpened=!0)},async getCompanyPermissions(e){await this.customerService.getCompanyPermissionsAsync(e).then(i=>{this.permissions=i})},async viewProviderPermissions(e){this.isShowProviderViewer=!1,this.isLoading=!0,await this.getCompanyPermissions(e);const i={};for(const r of this.permissions)i[r.categoryName]||(i[r.categoryName]={categoryName:r.categoryName,permissions:[]}),i[r.categoryName].permissions.push(r);let t=Object.keys(i).map(r=>i[r]);const s=(r,o)=>{const u="Other Activities";return r.categoryName===u?1:o.categoryName===u?-1:r.categoryName.localeCompare(o.categoryName)};t.sort(s),this.permissionsCategorized=t,this.isShowProviderPermissions=!0,this.isLoading=!1},async saveChangesAsync(){if(!this.currentArCustomer)return;const{email:e=""}=this.currentArCustomer,i=this.currentArCustomer;if(i.providers=this.updatedProvidersList,!this.isEdit){f({title:this.$t("common-alert-title"),content:"Do you wish to save these changes?",confirmButtonText:"Confirm & Save",type:P.ALERT,onConfirm:async()=>{const s="<center>Changes Saved.</center>";this.isShowProviderForm=!1,this.isLoading=!0,this.isShowSavingText=!0,await this.updateCustomerArByEmailAsync(e,i).then(()=>{this.isLoading=!1,this.isShowSavingText=!1,this.showToastMessage(s)})}});return}const t=this.isEdit?"<center>Provider Details Saved.</center><br /> Please complete the Provider Profile <a style='color: var(--color-primary)' href=''>here</a>.":`<center>New Provider Added.</center><br /> <center>We have emailed ${e} to complete their profile.</center>`;this.isShowProviderForm=!1,this.isLoading=!0,this.isShowSavingText=!0,await this.updateCustomerArByEmailAsync(e,i).then(()=>{this.isLoading=!1,this.isShowSavingText=!1,this.showToastMessage(t)})},async saveOrUpdateProviderAsync(e){e&&(e&&e.id.length===0&&(e.id=q()),e.ddStatus="Complete",e.status="Onboarding",e.startDate=this.helperService.getCurrentDateTimeInEpoch(),f({title:this.$t("common-alert-title"),content:"Provider is incomplete. Are you sure you wish to proceed?",type:P.SAVEDETAILS,confirmButtonText:"Proceed",saveDetailsText:"Complete Now",width:440,onConfirm:async()=>{this.updatedProvidersList=this.currentProvidersList;const i=this.updatedProvidersList.findIndex(t=>t.id===e.id);i>-1?(this.isEdit=!0,this.updatedProvidersList[i]=e):this.updatedProvidersList.push(e),await this.saveChangesAsync(),this.eventBus.emit(n.formFieldChangedEvent),this.eventBus.emit(n.formFieldPageLevelChangedEvent)},onSaveDetails:()=>{var i,t,s,r;(r=(s=(t=(i=this.$refs)==null?void 0:i.formElement)==null?void 0:t.$el)==null?void 0:s.requestSubmit)==null||r.call(s)}}))},showToastMessage(e){S({type:w.SUCCESS,interval:4e3,content:e})},requestToComplete(e){if(!e)return;const i="Provider Name";f({title:this.$t("common-alert-title"),content:`Please confirm that you are happy for us to email ${i} to complete their profile.`,confirmButtonText:"Confirm & Send Email",cancelButtonText:"Cancel",type:P.SAVEDETAILS,saveDetailsText:"Save Details",isShowSaveDetailsButton:!0,width:440,onConfirm:async()=>{S({type:w.SUCCESS,content:`<center>New Provider Added.</center> <br /> We have emailed ${i} to complete their profile.`,interval:n.notificationPopupTimeOut})},onSaveDetails:()=>{S({type:w.SUCCESS,content:"<center>Provider Details Saved.</center> <br /> Please complete the Provider Profile <a style='color: var(--color-primary)' href=''>here</a>.",interval:5e3})}})},showProviderForm(){this.isShowProviderForm=!0},closeProviderForm(){this.isShowProviderForm=!1,this.isShowProviderViewer=!1,this.isShowTasksViewer=!1,this.isShowProviderPermissions=!1},mapAppointedRepresentativesToProviders(e){const i=[];for(const t of e){let s=new E;s.name=t.principalFirmName,s.fcaFirmRefNo=t.principalFrn;const r=new d;r.startDate=t.effectiveDate,r.startDateString=t.effectiveDateStr??"";const o=new E;o.name=t.name??"",o.fcaFirmRefNo=t.frn??"",r.details=o,i.push(r)}return i},open(e,i){e.isContextMenuOpen||this.currentProvidersList.forEach(t=>t.isContextMenuOpen=!1),this.offsetX=i.clientX+10,this.offsetY=i.clientY+10,e.isContextMenuOpen=!e.isContextMenuOpen},onMenuSelect(e,i){var t;try{const s=e.item,r=(t=i.details)==null?void 0:t.name;if(s.text==="Archive"){alert(`${r} is archived!`);return}this.$router.push("/my-providers")}finally{this.currentProvidersList.forEach(s=>s.isContextMenuOpen=!1)}}}});function Z(e,i,t,s,r,o){const u=K,T=W,L=G,N=c("ARProvidersList"),_=c("ARViewProviderModal"),D=c("ARProviderFormModal"),V=c("ARTasksModal"),F=c("ViewProviderPermissions");return v(),x(H,null,[C(u,{isLoading:e.isLoading,isShowSavingText:e.isShowSavingText},null,8,["isLoading","isShowSavingText"]),C(T),C(L,{title:e.$t("providersPage-header")},{description:j(()=>[X("p",null,Y(e.$t("ar-providers-description",{currentFirmName:e.firmName})),1)]),_:1},8,["title"]),e.isShowProvidersAsList?(v(),h(N,{key:0,providers:e.currentProvidersList,onAddNewProvider:e.addNewProvider,onViewProviderList:e.viewProvider,onViewProviderCard:e.viewProvider,onEditProviderList:e.editProvider,onEditProviderCard:e.editProvider,onViewTasksCard:e.viewTasks},null,8,["providers","onAddNewProvider","onViewProviderList","onViewProviderCard","onEditProviderList","onEditProviderCard","onViewTasksCard"])):p("",!0),e.isShowProviderViewer?(v(),h(_,{key:1,provider:e.provider,onClose:e.closeProviderForm,onViewEditProvider:e.viewEditProvider,onViewProviderPermissions:e.viewProviderPermissions},null,8,["provider","onClose","onViewEditProvider","onViewProviderPermissions"])):p("",!0),e.isShowProviderForm?(v(),h(D,{key:2,provider:e.provider,saving:!1,isEditMode:e.isEditMode,onClose:e.closeProviderForm,onSubmit:e.saveOrUpdateProviderAsync,onRequestToComplete:e.requestToComplete},null,8,["provider","isEditMode","onClose","onSubmit","onRequestToComplete"])):p("",!0),e.isShowTasksViewer?(v(),h(V,{key:3,tasks:e.providerTasks,providerName:e.providerName,onClose:e.closeProviderForm},null,8,["tasks","providerName","onClose"])):p("",!0),e.isShowProviderPermissions?(v(),h(F,{key:4,items:e.permissionsCategorized,onClose:e.closeProviderForm},null,8,["items","onClose"])):p("",!0)],64)}const ie=J(Q,[["render",Z]]);export{ie as default};
