import{D as w,ab as j,bb as z,bI as V,b1 as E,j as G,aa as g,A as l,I as q,l as T,ag as K,b3 as L,a3 as b,am as H,b4 as J,as as P,at as Q,au as W,av as X,b6 as S,az as R,aA as y,o as O,m as Y,n as a,w as r,J as Z,aC as x,aH as ee,P as n,x as u,r as _,q as te,y as se,aG as ie,bo as ae,c8 as ne,a2 as oe,O as re,a5 as le,a6 as pe,_ as de}from"./index-9d6d511f.js";import{_ as ce}from"./GridCardTable-248623f7.js";const C=w.resolve(j.name),k=z("appointedRepresentativesStore",{state:()=>({appointedRepresentatives:[],appointedRepresentative:void 0,appointedRepresentativesTotal:0}),actions:{setAppointedRepresentative(e){this.appointedRepresentative=e},getAppointedRepresentative(e){return this.appointedRepresentatives.find(t=>t.id===e)},appendAppointedRepresentative(e){return this.appointedRepresentatives=[...this.appointedRepresentatives,e],e},amendAppointedRepresentative(e,t){let i;return this.appointedRepresentatives=this.appointedRepresentatives.map(o=>o.id===e?(i={...o,...t},i):o),i},removeAppointedRepresentative(e){this.appointedRepresentatives=this.appointedRepresentatives.filter(t=>t.id!==e)},async fetchAppointedRepresentativesAsync(e){const t=V(),{currentCustomer:i}=E(t);try{const o=await C.getAppointedRepresentativesAsync(i.value.id,e);return this.appointedRepresentativesTotal=o.total,this.appointedRepresentatives=o.data,Promise.resolve(o.data)}catch(o){return Promise.reject(o)}},async fetchAppointedRepresentativeAsync(e,t=!0){try{const i=await C.getAppointedRepresentativeAsync(e);return t&&this.setAppointedRepresentative(i),Promise.resolve(this.appointedRepresentative)}catch(i){return Promise.reject(i)}},async saveOrUpdateAppointedRepresentativeAsync(e,t=!0){try{const i=V(),{currentCustomer:o}=E(i),d=await C.saveOrUpdateAppointedRepresentativeAsync({...e,customerId:o.value.id});if(t){let f=!1;this.appointedRepresentatives=this.appointedRepresentatives.map(c=>c.id===e.id?(f=!0,{...c,...d}):c),f||(this.appointedRepresentatives=[...this.appointedRepresentatives,d]),this.setAppointedRepresentative(d)}return Promise.resolve(d)}catch(i){return Promise.reject(i)}}}}),ue=G({components:{DetailsModal:g(()=>R(()=>import("./DetailsModal-c5e459fb.js"),["assets/DetailsModal-c5e459fb.js","assets/ModalComponent.vue_vue_type_script_setup_true_lang-fe9b98ed.js","assets/index-9d6d511f.js","assets/index-982d5504.css","assets/NumberListComponent-fb44b311.js","assets/NumberListComponent-b356df60.css","assets/KendoNationalityInputComponent-5a552edf.js","assets/KendoNationalityInputComponent-37e5dd00.css","assets/StatusLabelComponent.vue_vue_type_script_setup_true_lang-90f1f182.js","assets/GridCardTable-248623f7.js","assets/GridCardTable-d4d68ddc.css","assets/DetailsModal-c420311c.css"])),TableActions:g(()=>R(()=>import("./TableActions-1f90da96.js"),["assets/TableActions-1f90da96.js","assets/index-9d6d511f.js","assets/index-982d5504.css","assets/TableActions-141d0538.css"])),StatusLabel:g(()=>R(()=>import("./StatusLabel-e8e4aaa5.js"),["assets/StatusLabel-e8e4aaa5.js","assets/StatusLabelComponent.vue_vue_type_script_setup_true_lang-90f1f182.js","assets/index-9d6d511f.js","assets/index-982d5504.css"]))},data(){return{AppConstants:l,isLoading:!1,helperService:w.resolve(q.name),activeGroup:"current",tableGroups:[{title:"Current",value:"current"},{title:"All",value:"all"}],columns:[{field:"name",title:"Appointed Representative Name",width:260},{field:"frn",title:"FRN",width:150,className:"text-center"},{field:"activities",title:"Activities",width:300},{field:"cf1",title:"CF1 (AR)"},{field:"status",title:"Status",className:"text-center"},{field:"tasks",title:"Tasks",className:"text-center"},{field:"actions",title:" ",className:"text-center",width:130}],isAddModalVisible:!1,isViewModalVisible:!1,isEditModalVisible:!1,activeAppointedRepresentative:void 0,isFetching:!1,eventBus:T("$eventBusService"),eventBusFormSaved:T("$eventBusService"),tableLoading:!1,tableSettings:{pageSize:10,pageNumber:1,skip:0,filters:{}},userSubmittedChangesService:w.resolve(K.name),isSavingAlertOpened:!1,isShowSavingText:!1}},provide(){return{editItem:this.onEditItemAsync}},computed:{...L(V,["currentCustomer","currentFirmName"]),...L(k,["appointedRepresentatives","appointedRepresentativesTotal"]),products(){return Object.fromEntries(b.getARProducts().map(({id:e,title:t})=>[e,t]))},statusesOptions(){return b.getARStatuses()},activitiesOptions(){return b.getARProductTypes().map(({title:e,id:t})=>({value:t,label:e}))},items(){return this.activeGroup==="current"?this.appointedRepresentatives.filter(e=>[0,1].includes(e.status)):this.appointedRepresentatives}},created(){this.changeLifeCycleName(l.pageLifeCycleNameCreated)},async mounted(){await this.fetchDataAsync(),this.eventBus.emit(l.bottomBarEnableEvent,!0),this.eventBusFormSaved.on(l.formSavedEvent,e=>this.handleSubmit(e)),this.changeLifeCycleName(l.pageLifeCycleNameMounted)},unmounted(){this.eventBus.emit(l.bottomBarEnableEvent,!1),this.eventBusFormSaved.off(l.formSavedEvent)},setup(){const e=H(),{changeLifeCycleName:t}=e;return{changeLifeCycleName:t}},methods:{...J(k,["fetchAppointedRepresentativesAsync","fetchAppointedRepresentativeAsync"]),async fetchDataAsync(){this.isLoading=!0,await this.fetchARDataAsync(),this.isLoading=!1},async fetchARDataAsync(){const{pageSize:e,pageNumber:t,filters:i}=this.tableSettings;this.tableLoading=!0;try{await this.fetchAppointedRepresentativesAsync({pageSize:e,pageNumber:t,...i})}catch{throw new Error("Something went wrong.")}finally{this.tableLoading=!1}},handleSubmit(e){this.isSavingAlertOpened||(e?P({title:"Confirm",content:"Appointed Representatives is incomplete. Are you sure you wish to proceed?",confirmButtonText:"Proceed",saveDetailsText:"Complete Now",type:Q.SAVEDETAILS,width:390,onSaveDetails:()=>{this.isSavingAlertOpened=!1},onConfirm:async()=>{this.saveInfoAsync(!0,e)},onCancel:()=>{this.isSavingAlertOpened=!1},onClose:()=>{this.isSavingAlertOpened=!1}}):P({title:"Confirm",content:"Please make sure the details are correct",confirmButtonText:"Confirm & Save",onConfirm:async()=>{this.saveInfoAsync(!0)},onCancel:()=>{this.isSavingAlertOpened=!1},onClose:()=>{this.isSavingAlertOpened=!1}}),this.isSavingAlertOpened=!0)},saveInfoAsync(e=!1,t=!1){this.userSubmittedChangesService.hasUserSubmittedChangesToRemoteApi=!0,this.isSavingAlertOpened=!1,e&&W({type:X.SUCCESS,content:this.$t("common-notification-saved"),interval:l.notificationPopupTimeOut}),this.isLoading=!1,this.isShowSavingText=!1,t&&setTimeout(()=>this.eventBus.emit(l.autoNextEvent),l.notificationPopupTimeOut)},async onViewItemAsync(e){this.isFetching=!0;const t=await this.fetchAppointedRepresentativeAsync(e);this.isFetching=!1,t&&(this.activeAppointedRepresentative=t,this.isViewModalVisible=!0)},async onEditItemAsync(e){this.isFetching=!0;const t=await this.fetchAppointedRepresentativeAsync(e);this.isFetching=!1,t&&(this.activeAppointedRepresentative=t,this.isEditModalVisible=!0)},async tableFilterAsync(e){const{values:t}=e;if(S(t))return;const i={};S(t.activities)||(i.activities=t.activities.value),S(t.status)||(i.status=t.status.value),this.tableSettings={...this.tableSettings,filters:{...this.tableSettings.filters,...i},skip:0,pageNumber:1},await this.fetchARDataAsync()},async tablePageChangedAsync(e){const{skip:t,take:i}=e.page,o=Math.ceil(t/i+1);this.tableSettings={...this.tableSettings,skip:t,pageNumber:o},await this.fetchARDataAsync()},async tableSearchAsync(e){this.tableSettings={...this.tableSettings,filters:{...this.tableSettings.filters,search:e},skip:0,pageNumber:1},await this.fetchARDataAsync()},async tableClearAsync(){this.tableSettings={...this.tableSettings,filters:{...this.tableSettings.filters,activities:null,status:null},skip:0,pageNumber:1},await this.fetchARDataAsync()},formatItems(e){return e.map(t=>([2,3].includes(t.status)&&(t.inactive=!0),t))},setUniqueIdentifier(e){return`${l.appointedRepresentativesRoute}${e}`.replace(/\s+/g,"").replace("/","")}}}),v=e=>(le("data-v-7edbcada"),e=e(),pe(),e),me={class:"text-center"},ve={href:"javascript:;",class:"text-success text-underline"},fe={class:"is-truncated d-inline-block w-100"},he={class:"text-center"},Ae=v(()=>n("div",{class:"text-center"},[n("a",{href:"javascript:;"},[n("strong",null,"1")])],-1)),ge={href:"#"},be=v(()=>n("span",{class:"font-size-sm"}," [CF1 AR Name] ",-1)),Se=v(()=>n("div",{class:"text-center mt-2"},[n("span",{class:"font-size-xs text-neutral"},"Activities"),n("div",{class:"font-size-sm"}," Mortgage Broking, General Insurance Broking ")],-1)),Re={class:"d-flex gap-3 mt-3"},ye=v(()=>n("div",{class:"font-weight-semi-bold",style:{padding:"3px"}},"View Tasks",-1));function _e(e,t,i,o,d,f){const c=x,B=ie,D=ee,h=ae,M=ne,F=y("StatusLabel"),I=y("TableActions"),N=oe,$=re,U=ce,A=y("DetailsModal");return O(),Y(Z,null,[a(c,{isLoading:e.isLoading},null,8,["isLoading"]),a(B),a(D,{title:e.$t("appointedRepresentativesPage-header"),description:e.$t("appointedRepresentativesPage-subHeader",{currentFirmName:e.currentFirmName}),routeName:e.helperService.removeStringSpacesThenSlash(e.AppConstants.appointedRepresentativesRoute),class:"PageTitle"},null,8,["title","description","routeName"]),a(U,{"add-button-text":"Add New Appointed Representative",class:"appointed-representative-table",columns:e.columns,items:e.formatItems(e.items),groups:e.tableGroups,"active-group":e.activeGroup,"onUpdate:activeGroup":t[0]||(t[0]=s=>e.activeGroup=s),"no-actionbar":!1,"search-placeholder":"Search Name, FRN",pageable:"",skip:e.tableSettings.skip,take:e.tableSettings.pageSize,total:e.appointedRepresentativesTotal,loading:e.tableLoading,handlePageChange:e.tablePageChangedAsync,onAdd:t[1]||(t[1]=s=>e.isAddModalVisible=!0),onFilter:e.tableFilterAsync,onSearch:e.tableSearchAsync,onClear:e.tableClearAsync},{"cell-name":r(({item:s})=>[a(h,{text:s.name,rounded:"full","text-truncated":""},null,8,["text"])]),"cell-frn":r(({item:s})=>[n("div",me,[n("a",ve,u(s.firmReferenceNumber),1)])]),"cell-activities":r(({item:s})=>[a(M,{items:s.activities,"popup-title":"Activities"},{"visible-items":r(({items:p})=>[n("span",fe,u(p.map(m=>e.products[m.productId]).join(", ")),1)]),"popup-item":r(({item:p})=>[_(u(e.products[p.productId]),1)]),_:2},1032,["items"])]),"cell-cf1":r(({item:{representative:s}})=>[s.forename||s.surname?(O(),te(h,{key:0,text:`${s.forename||""} ${s.surname||""}`,rounded:"full","text-truncated":""},null,8,["text"])):se("",!0)]),"cell-status":r(({item:s})=>[n("div",he,[a(F,{item:s},null,8,["item"])])]),"cell-tasks":r(({item:s})=>[Ae]),"cell-actions":r(({item:s})=>[a(I,{item:s,onView:e.onViewItemAsync,onEdit:e.onEditItemAsync},null,8,["item","onView","onEdit"])]),"filter-fields":r(({form:s})=>{var p,m;return[a(N,{name:"activities",id:e.setUniqueIdentifier("-activities"),label:"Activities","data-items":e.activitiesOptions,value:(p=s.values)==null?void 0:p.activities,class:"mb-3"},null,8,["id","data-items","value"]),a(N,{name:"status",id:e.setUniqueIdentifier("-status"),label:"Status","data-items":e.statusesOptions,value:(m=s.values)==null?void 0:m.status,class:"mb-3"},null,8,["id","data-items","value"])]}),"card-content":r(({item:s})=>[a(h,{size:"large",rounded:"full",text:s.name,"text-truncated":""},{text:r(()=>[n("strong",null,[_(u(s.name)+" (",1),n("a",ge,u(s.firmReferenceNumber),1),_(") ")])]),subtext:r(()=>[be]),_:2},1032,["text"]),Se,n("div",Re,[a($,{"fill-mode":"outline","theme-color":"success",size:"small",class:"flex-grow-1"},{default:r(()=>[ye]),_:1}),a(I,{item:s,onView:e.onViewItemAsync,onEdit:e.onEditItemAsync},null,8,["item","onView","onEdit"])])]),_:1},8,["columns","items","groups","active-group","skip","take","total","loading","handlePageChange","onFilter","onSearch","onClear"]),a(A,{modelValue:e.isAddModalVisible,"onUpdate:modelValue":t[2]||(t[2]=s=>e.isAddModalVisible=s)},null,8,["modelValue"]),a(A,{modelValue:e.isViewModalVisible,"onUpdate:modelValue":t[3]||(t[3]=s=>e.isViewModalVisible=s),value:e.activeAppointedRepresentative,viewMode:"",width:"1000",onClose:t[4]||(t[4]=()=>{e.activeAppointedRepresentative=void 0})},null,8,["modelValue","value"]),a(A,{modelValue:e.isEditModalVisible,"onUpdate:modelValue":t[5]||(t[5]=s=>e.isEditModalVisible=s),value:e.activeAppointedRepresentative,editMode:"",onClose:t[6]||(t[6]=()=>{e.activeAppointedRepresentative=void 0})},null,8,["modelValue","value"])],64)}const Ce=de(ue,[["render",_e],["__scopeId","data-v-7edbcada"]]),Ie=Object.freeze(Object.defineProperty({__proto__:null,default:Ce},Symbol.toStringTag,{value:"Module"}));export{Ie as A,k as u};
