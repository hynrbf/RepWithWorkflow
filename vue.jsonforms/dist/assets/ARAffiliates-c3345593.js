import{j as T,A as a,aa as m,l as y,aq as S,bB as n,aj as I,D as f,ac as D,I as B,af as R,ab as F,bz as $,ag as O,am as M,bd as k,as as w,at as C,au as A,av as v,az as d,aA as c,o as r,m as z,n as g,w as U,P as q,x as j,q as p,y as u,J as H,aC as K,aG as G,aH as J,_ as W}from"./index-9d6d511f.js";const Q=T({name:"ARAffiliates",computed:{AppConstants(){return a}},components:{AffiliatesList:m(()=>d(()=>import("./ARAffiliatesList-b4a187a9.js"),["assets/ARAffiliatesList-b4a187a9.js","assets/index-9d6d511f.js","assets/index-982d5504.css","assets/rejected-grey-icon-2a930ba1.js"])),AffiliatesCard:m(()=>d(()=>import("./ARAffiliatesCard-b68e27b9.js"),["assets/ARAffiliatesCard-b68e27b9.js","assets/index-9d6d511f.js","assets/index-982d5504.css","assets/ARAffiliatesCard-505f6cb7.css"])),AddAffiliatesModal:m(()=>d(()=>import("./ARAddAffiliatesModal-12b308b7.js"),["assets/ARAddAffiliatesModal-12b308b7.js","assets/ModalComponent.vue_vue_type_script_setup_true_lang-fe9b98ed.js","assets/index-9d6d511f.js","assets/index-982d5504.css","assets/KendoFirmFinderComponent-9a5bf623.js","assets/KendoFirmFinderComponent-d11737a3.css","assets/ARAddAffiliatesModal-1b78fd78.css"])),ViewAffiliateModal:m(()=>d(()=>import("./ARViewAffiliateModal-a5fc16ed.js"),["assets/ARViewAffiliateModal-a5fc16ed.js","assets/index-9d6d511f.js","assets/index-982d5504.css","assets/ARViewAffiliateModal-bed4bf9f.css"])),ViewAffiliatePermissions:m(()=>d(()=>import("./ARViewAffiliatePermissions-44f61e8e.js"),["assets/ARViewAffiliatePermissions-44f61e8e.js","assets/index-9d6d511f.js","assets/index-982d5504.css","assets/ViewProviderPermissions-9ee24b6f.css"]))},data(){return{eventBus:y("$eventBusService"),eventBusFormSaved:y("$eventBusService"),currentTab:0,isLoading:!1,isShowSavingText:!1,firmName:"<Firm Name>",tabs:[{title:"Current",content:"current"},{title:"All",content:"all"}],isShowAffiliatesList:!0,isShowAffiliatesCard:!1,isShowAffiliatePermissions:!1,isAdd:!0,isInitializing:!0,isShowAffiliateViewer:!1,isSavingAlertOpened:!1,arCustomer:new S,affiliate:new n,affiliateList:[],affiliateInputFirm:new I,isAffiliateModalVisible:!1,appService:f.resolve(D.name),helperService:f.resolve(B.name),fcaService:f.resolve(R.name),customerArService:f.resolve(F.name),customerService:f.resolve($.name),permissions:[],permissionsCategorized:[],userSubmittedChangesService:f.resolve(O.name)}},created(){this.arCustomer=this.appService.getCachedCustomerAppointedRepresentative()??new S,this.affiliateList=this.arCustomer.affiliates??[],this.isInitializing=!1,this.firmName=this.arCustomer.companyName??"",this.changeLifeCycleName(a.pageLifeCycleNameCreated)},mounted(){this.eventBus.emit(a.bottomBarEnableEvent,!0),this.eventBusFormSaved.on(a.formSavedEvent,e=>this.handleAutoNext(e)),this.arCustomer=this.appService.getCachedCustomerAppointedRepresentative()??new S,this.changeLifeCycleName(a.pageLifeCycleNameMounted)},unmounted(){this.eventBus.emit(a.bottomBarEnableEvent,!1),this.eventBusFormSaved.off(a.formSavedEvent),this.isLoading=!1},setup(){const e=M(),{changeLifeCycleName:i}=e;return{changeLifeCycleName:i}},methods:{closeForm(){this.isAffiliateModalVisible=!1,this.isShowAffiliateViewer=!1,this.isShowAffiliatePermissions=!1},showAffiliateForm(){this.isAffiliateModalVisible=!0},async onAffiliatesDetailUpdated(e){this.affiliate&&(this.affiliate.details.name=e.firmName,this.affiliate.details.companyNumber=e.companyNumber,this.affiliate.details.firmReferenceNumber=e.firmReferenceNumber,this.affiliateInputFirm=e,this.affiliate.details.registeredAddress=e.address)},isCompanyExisting(e,i){return e.some(o=>{const s=o.details;return s.name===i.name&&s.companyNumber===i.companyNumber&&s.firmReferenceNumber===i.firmReferenceNumber})},viewAffiliate(e){var i,o,s,t;this.isShowAffiliateViewer=!0,this.affiliate=this.affiliateList.find(l=>l.id===e)??new n,this.affiliate.details&&(this.affiliate.details.contactNumberDisplay=`${((i=this.affiliate.details.contactNumber)==null?void 0:i.dialCode)??""} ${((o=this.affiliate.details.contactNumber)==null?void 0:o.number)??""}`),this.affiliate.representative&&(this.affiliate.representative.contactNumberDisplay=`${((s=this.affiliate.representative.contactNumber)==null?void 0:s.dialCode)??""} ${((t=this.affiliate.representative.contactNumber)==null?void 0:t.number)??""}`)},viewEditAffiliate(e){this.isShowAffiliateViewer=!1,this.affiliate=this.affiliateList.find(i=>i.id===e)??new n,this.showAffiliateForm()},async viewAffiliatePermissions(e){this.isShowAffiliateViewer=!1,this.isLoading=!0,await this.getCompanyPermissions(e);const i={};for(const t of this.permissions)i[t.categoryName]||(i[t.categoryName]={categoryName:t.categoryName,permissions:[]}),i[t.categoryName].permissions.push(t);let o=Object.keys(i).map(t=>i[t]);const s=(t,l)=>{const h="Other Activities";return t.categoryName===h?1:l.categoryName===h?-1:t.categoryName.localeCompare(l.categoryName)};o.sort(s),this.permissionsCategorized=o,this.isShowAffiliatePermissions=!0,this.isLoading=!1},addNewAffiliate(){this.isAdd=!0,this.affiliate=new n,this.showAffiliateForm()},editAffiliate(e){this.isAdd=!1,this.affiliate=this.affiliateList.find(i=>i.id===e)??new n,this.showAffiliateForm()},async getCompanyPermissions(e){await this.customerService.getCompanyPermissionsAsync(e).then(i=>{this.permissions=i})},async saveChanges(){const e=await this.customerArService.getAppointedRepresentativesByEmailAsync(this.arCustomer.email??"");this.isShowSavingText=!0,this.isLoading=!0;for(let i of this.affiliateList)i.id=k();e.affiliates=this.affiliateList,this.closeForm(),await this.customerArService.saveOrUpdateAppointedRepresentativeAsync(e).then(()=>{this.isShowSavingText=!1,this.isLoading=!1,this.showModal(this.isAdd?"<center>Affiliate Details Saved.</center> <br /> Please complete the Affiliate Profile <a style='color: var(--color-primary)' href=''>here</a>.":"Changes Saved.")})},async saveAffiliateDetailsAsync(e){e.ddStatus="Complete",e.statusImg="/bookmark_green.svg",e.providerImg="/add_profile_photo.png",e.status="Onboarding",w({title:this.$t("common-alert-title"),content:"Affiliate is incomplete. Are you sure you wish to proceed?",type:C.SAVEDETAILS,confirmButtonText:"Proceed",saveDetailsText:"Complete Now",width:440,onConfirm:async()=>{this.isCompanyExisting(this.affiliateList,e.details)||this.affiliateList.push(e),await this.saveChanges()},onSaveDetails:()=>{this.triggerSubmit()}}),this.affiliate=new n},handleAutoNext(e){this.isSavingAlertOpened||(w({title:this.$t("common-alert-title"),content:"Affiliates is incomplete. Are you sure you wish to proceed?",type:C.SAVEDETAILS,confirmButtonText:"Proceed",saveDetailsText:"Complete Now",width:440,onConfirm:async()=>{this.userSubmittedChangesService.hasUserSubmittedChangesToRemoteApi=!0,this.isSavingAlertOpened=!1,A({type:v.SUCCESS,content:this.$t("common-notification-saved"),interval:a.notificationPopupTimeOut}),e&&setTimeout(()=>this.eventBus.emit(a.autoNextEvent),0)},onSaveDetails:()=>{this.isSavingAlertOpened=!1}}),this.isSavingAlertOpened=!0)},triggerSubmit(){this.$refs.affiliateFormModal.triggerSubmit()},showModal(e){A({type:v.SUCCESS,interval:1e4,content:e})},requestToComplete(e){if(!e)return;const i="Affiliate Name";w({title:this.$t("common-alert-title"),content:`Please confirm that you are happy for us to email ${i} to complete their profile.`,confirmButtonText:"Confirm & Send Email",cancelButtonText:"Cancel",type:C.SAVEDETAILS,saveDetailsText:"Save Details",isShowSaveDetailsButton:!0,width:440,onConfirm:async()=>{A({type:v.SUCCESS,content:`<center>New Affiliate Added.</center> <br /> We have emailed ${i} to complete their profile.`,interval:a.notificationPopupTimeOut})},onSaveDetails:async()=>{await this.saveAffiliateDetailsAsync(e),A({type:v.SUCCESS,content:"<div class='text-center'>Affiliate Details Saved.</div> <br /> Please complete the Affiliate Profile <a style='color: var(--color-primary)' href=''>here</a>.",interval:5e3})}})}}});function X(e,i,o,s,t,l){const h=K,N=G,b=J,L=c("AffiliatesList"),_=c("AffiliatesCard"),E=c("AddAffiliatesModal"),V=c("ViewAffiliateModal"),P=c("ViewAffiliatePermissions");return r(),z(H,null,[g(h,{isLoading:e.isLoading,isShowSavingText:e.isShowSavingText},null,8,["isLoading","isShowSavingText"]),g(N),g(b,{title:"Appointed Representatives Affiliates",routeName:e.helperService.removeStringSpacesThenSlash(e.AppConstants.arAffiliatesRoute)},{description:U(()=>[q("p",null,j(e.$t("ar-affiliates-description",{FirmName:e.firmName})),1)]),_:1},8,["routeName"]),e.isShowAffiliatesList?(r(),p(L,{key:0,"affiliates-values":e.affiliateList,onAddNewAffiliate:e.addNewAffiliate,onViewAffiliateList:e.viewAffiliate,onViewAffiliateCard:e.viewAffiliate,onEditAffiliateList:e.editAffiliate,onEditAffiliateCard:e.editAffiliate},null,8,["affiliates-values","onAddNewAffiliate","onViewAffiliateList","onViewAffiliateCard","onEditAffiliateList","onEditAffiliateCard"])):u("",!0),e.isShowAffiliatesCard?(r(),p(_,{key:1,"affiliates-values":e.affiliateList,onViewAffiliate:e.viewAffiliate,onEditAffiliate:e.editAffiliate},null,8,["affiliates-values","onViewAffiliate","onEditAffiliate"])):u("",!0),e.isAffiliateModalVisible?(r(),p(E,{key:2,"affiliate-values":e.affiliateList,affiliate:e.affiliate,isAdd:e.isAdd,onClose:e.closeForm,onSubmit:e.saveAffiliateDetailsAsync,onRequestToComplete:e.requestToComplete,ref:"affiliateFormModal"},null,8,["affiliate-values","affiliate","isAdd","onClose","onSubmit","onRequestToComplete"])):u("",!0),e.isShowAffiliateViewer?(r(),p(V,{key:3,affiliate:e.affiliate,onClose:e.closeForm,onViewEditAffiliate:e.viewEditAffiliate,onViewAffiliatePermissions:e.viewAffiliatePermissions},null,8,["affiliate","onClose","onViewEditAffiliate","onViewAffiliatePermissions"])):u("",!0),e.isShowAffiliatePermissions?(r(),p(P,{key:4,items:e.permissionsCategorized,onClose:e.closeForm},null,8,["items","onClose"])):u("",!0)],64)}const Z=W(Q,[["render",X],["__scopeId","data-v-36ddf3ba"]]);export{Z as default};
