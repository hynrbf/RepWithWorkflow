import{j as le,A as L,D as W,I as me,ab as ue,l as ce,ac as re,G as b,aV as de,am as ve,aq as x,Z as U,a3 as Y,aW as pe,aX as he,aY as fe,as as ee,at as ie,au as Z,av as J,o as c,m as P,n as C,w as r,P as g,x as z,q as A,a0 as ye,y as M,$ as te,J as Ce,aC as ge,aG as Ae,aH as Ie,aZ as Ve,Y as be,a_ as we,a4 as Le,a$ as Pe,Q as ke,N as Se,b0 as _e,S as Re,aT as Ne,aU as $e,a5 as Te,a6 as Fe,_ as qe}from"./index-9d6d511f.js";import{_ as Ee}from"./InfoTableComponent.vue_vue_type_script_setup_true_lang-a9fe18e7.js";import{_ as Ue,a as Me}from"./rejected-grey-icon-2a930ba1.js";const Oe=le({name:"ARActivities",data(){return{AppConstants:L,helperService:W.resolve(me.name),isInitializing:!0}},setup(){const e=W.resolve(ue.name),d=ce("$eventBusService"),O=W.resolve(re.name),p=b(new x),{currentArFirmName:F,currentArCustomer:k}=de(),y=ve(),{changeLifeCycleName:S}=y,j=b("Richdale"),_=b(!1),R=b(!1),I=b({});p.value=O.getCachedCustomerAppointedRepresentative()??new x;const V=b([]),q=b([]),v=U({get(){return V.value.reduce((a,t)=>({...a,[t.productId]:t}),{})},set(a){V.value=Object.values(a)}}),B=b(Y.getARProductTypes()),w=b(Y.getARProducts()),K=U(()=>[{field:"product",title:"Product"},{field:"appointment",title:"Status"},{field:"requestStatus",title:"Add/Remove"},{field:"annualFeeIncome",title:"Projected Annual Fee Income"},{field:"annualCommissionIncome",title:"Projected Annual Commission Income"},{field:"hasLimitation",title:"Limitations"},{field:"action",title:" "}]),D=U(()=>Y.getARActivityProducts()),G=U(()=>D.value.map(({id:a,title:t,icon:m})=>({id:`activity-nav-${a}`,anchorTo:`panel-${a}`,label:t,icon:m}))),H=U(()=>D.value.map(({id:a,title:t})=>({id:a,title:t,content:a,contentClass:"p-0",active:a==="mortgage-broking"}))),N=a=>{const t=w.value.filter(m=>m.typeId===a).map(m=>({product:m.id,annualFeeIncome:{amount:0,currency:"GBP",symbol:"£"},annualCommissionIncome:{amount:0,currency:"GBP",symbol:"£"},limitations:"",isAppointed:!1,hasLimitation:!1,hasPendingApplication:!1,isModified:!1,isNewProduct:!1,isExpanded:!1}));return t.push({product:"add-more",annualFeeIncome:{amount:0,currency:"GBP",symbol:"£"},annualCommissionIncome:{amount:0,currency:"GBP",symbol:"£"},limitations:"",isAppointed:!1,hasLimitation:!1,hasPendingApplication:!1,isModified:!1,isNewProduct:!1,isExpanded:!1}),t},Q=(a,t)=>{const m=v.value[a],$=Object.keys(t)[0].toString();let T;$==="hasLimitation"&&typeof t.hasLimitation=="boolean"&&(T=t.hasLimitation||!1,t={hasLimitation:T,limitations:T?v.value[a].limitations:""}),($==="annualFeeIncome"||$==="annualCommissionIncome")&&(t={annualFeeIncome:t.annualFeeIncome,isModified:!0}),m?v.value={...v.value,[a]:{...m,...t}}:v.value={...v.value,[a]:{productId:a,...t}}},h=a=>w.value.find(t=>t.id===a),i=a=>{w.value=[...w.value,{...a}]},o=a=>{w.value=w.value.filter(t=>t.id!==a)},n=a=>"£ "+a.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"),l=(a,t)=>Object.values(v.value).reduce((m,$)=>{var X;const T=h($.productId);return!T||a!==T.typeId?m:m+(((X=$[t])==null?void 0:X.amount)||0)},0),u=b(),s=a=>{const t=a.filter(m=>m.active);if(t.length>0){const m=t[0].anchorTo;m!==void 0&&m!==""&&u.value.expand(m.replace(/^panel-/,"").trim())}},f=(a,t)=>{I.value={...I.value,[a]:{...I.value[a]??{},...t}}},E=a=>{const t=I.value[a];if(!t||!t.title||t.title==="")return;const m=t.title.replace(/ +/g,"-").toLowerCase();v.value={...v.value,[m]:{productId:m,annualFeeIncome:t.annualFeeIncome,annualCommissionIncome:t.annualCommissionIncome,isAppointed:t.isAppointed,hasLimitation:t.hasLimitation,limitations:t.limitations,hasPendingApplication:!0,isModified:t.isModified,isNewProduct:!0}},i({id:m,typeId:a,title:t.title}),delete I.value[a],d.emit(L.formFieldChangedEvent)},ne=a=>{const t=v.value;delete t[a],v.value=t,o(a)},se=async()=>{var t;_.value=!0,R.value=!0;const a=await e.getAppointedRepresentativesByEmailAsync(((t=p.value)==null?void 0:t.email)??"");a.activities=V.value,await e.saveOrUpdateAppointedRepresentativeAsync(a).then(()=>{_.value=!1,R.value=!1}).catch(()=>{Z({type:J.ERROR,content:"Something went wrong.",interval:5e3})}).finally(()=>{_.value=!1,R.value=!1})},oe=()=>{V.value=p.value.activities??[],q.value=p.value.activities??[]};return pe(()=>{S(L.pageLifeCycleNameCreated)}),he(()=>{S(L.pageLifeCycleNameMounted),d.emit(L.bottomBarEnableEvent,!0),oe()}),{isLoading:_,isShowSavingText:R,currentArCustomer:k,currentArFirmName:F,customerCompanyName:j,activities:V,activitiesOriginal:q,activityValues:v,newItems:I,types:B,columns:K,products:w,activitiesNavPill:G,activitiesPanels:H,getItems:N,updateValue:Q,getProduct:h,formatMoney:n,getTotal:l,openActivityPanel:s,attachNewItem:f,addNewItem:E,deleteItem:ne,saveInfoAsync:se,activityCollapsiblePanel:u,Money:fe}},mounted(){this.isInitializing=!1},methods:{updateRequestsValue(e,d,O){const p=this.activityValues[e],F=Object.keys(d)[0].toString(),k={[F]:!1};let y;switch(typeof d.isModified=="boolean"||typeof d.hasPendingApplication=="boolean"?y=d.isModified||d.hasPendingApplication:y=!1,O){case L.seekAuthAdd:ee({type:ie.ALERT,title:"Confirm",content:this.$t("common-alert-permissionConfirmAddText"),confirmButtonText:y?this.$t("common-alert-confirmAndCancelRequest"):this.$t("common-alert-confirmAndAdd"),confirmButtonThemeColor:y?"error":"primary",onConfirm:async()=>{Z({type:J.SUCCESS,content:y?this.$t("common-notification-CancelrequestSubmitted"):this.$t("common-notification-requestSubmitted"),interval:2e3}),p?this.activityValues={...this.activityValues,[e]:{...p,...d}}:this.activityValues={...this.activityValues,[e]:{productId:e,...d}},await this.saveInfoAsync()},onCancel:()=>{this.activityValues={...this.activityValues,[e]:{...p,...k}}},onClose:()=>{const S={[F]:!1};this.activityValues={...this.activityValues,[e]:{...p,...S}}}});break;case L.seekAuthRemove:ee({type:ie.ALERT,title:"Confirm",content:this.$t("common-alert-permissionConfirmAddText"),confirmButtonText:y?this.$t("common-alert-confirmAndCancelRequest"):this.$t("common-alert-confirmAndAdd"),confirmButtonThemeColor:y?"error":"primary",onConfirm:async()=>{Z({type:J.SUCCESS,content:y?this.$t("common-notification-CancelrequestSubmitted"):this.$t("common-notification-requestSubmitted"),interval:2e3}),p?this.activityValues={...this.activityValues,[e]:{...p,...d}}:this.activityValues={...this.activityValues,[e]:{productId:e,...d}},await this.saveInfoAsync()},onCancel:()=>{this.activityValues={...this.activityValues,[e]:{...p,...k}}},onClose:()=>{this.activityValues={...this.activityValues,[e]:{...p,...k}}}});break;default:throw new Error("We don't support this action in updatePermissions")}},setUniqueIdentifier(e){const d=`${L.arActivitiesRoute}${e}`;return this.helperService.removeStringSpacesThenSlash(d)}}}),ae=e=>(Te("data-v-d9956480"),e=e(),Fe(),e),Be=ae(()=>g("div",{class:"mb-3"},null,-1)),De={class:"ActivityCollapsiblePanel-title"},ze={key:0,src:Ue,alt:"Authorised",title:"Authorised",width:"16",height:"16"},je={key:1,src:Me,alt:"Non-Authorised",title:"Non-Authorised",width:"16",height:"16"},Ke={key:0},Ge={key:1},He={class:"mt-0"},We={key:0},Ye=["onClick"],Ze={key:1},Je=["onClick"],Qe=ae(()=>g("div",{class:"py-1"},[g("strong",null,"Total")],-1)),Xe={class:"py-1"},xe={class:"TotalText"},ei={class:"py-1"},ii={class:"TotalText"};function ti(e,d,O,p,F,k){const y=ge,S=Ae,j=Ie,_=Ve,R=be,I=we,V=Le,q=Pe,v=ke,B=Se,w=Ee,K=_e,D=Re,G=Ne,H=$e;return c(),P(Ce,null,[C(y,{isLoading:e.isLoading,isShowSavingText:e.isShowSavingText},null,8,["isLoading","isShowSavingText"]),C(S),C(j,{title:e.$t("ar-activities-header",{arFirmName:e.currentArFirmName}),description:e.$t("ar-activities-description",{firmName:e.customerCompanyName,arFirmName:e.currentArFirmName}),routeName:e.helperService.removeStringSpacesThenSlash(e.AppConstants.arActivitiesRoute),class:"PageTitle","progress-bar":""},null,8,["title","description","routeName"]),C(_,{items:e.activitiesNavPill,class:"ActivitiesNavPill page-tab-anchors is-sticky-top",anchorable:"","onUpdate:items":e.openActivityPanel},null,8,["items","onUpdate:items"]),Be,C(H,null,{default:r(()=>[C(G,{ref:"formElement"},{default:r(()=>[C(D,{orientation:"vertical",gap:20,style:{"margin-top":"20px"}},{default:r(()=>[C(K,{ref:"activityCollapsiblePanel",class:"ActivityCollapsiblePanel",items:e.activitiesPanels,accordion:!1},{title:r(({item:N})=>[g("div",De,[g("span",null,z(N.title),1)])]),content:r(({item:N,item:{product:Q}})=>[C(w,{class:"ActivityInfoTable",id:N.content,columns:e.columns,data:[{items:e.getItems(N.content),footer:!0}]},{"cell-product":r(({item:h,item:{product:i},id:o})=>{var n,l,u,s;return[i==="add-more"?(c(),A(R,{key:0,name:"add-more",placeholder:"Add Product","model-value":((n=e.newItems[o])==null?void 0:n.title)??"","onUpdate:modelValue":f=>e.attachNewItem(o,{title:f}),isRequired:!1},null,8,["model-value","onUpdate:modelValue"])):(c(),P("span",{key:1,class:ye({"is-edited":((l=e.activityValues[i])==null?void 0:l.isModified)||((u=e.activityValues[i])==null?void 0:u.hasPendingApplication)})},z((s=e.getProduct(i))==null?void 0:s.title),3))]}),"cell-appointment":r(({item:h,item:{product:i},id:o})=>{var n;return[(n=e.activityValues[i])!=null&&n.isAppointed?(c(),P("img",ze)):(c(),P("img",je))]}),"cell-requestStatus":r(({item:h,item:{product:i}})=>{var o,n,l,u;return[i==="add-more"?(c(),P("div",Ke,[C(I,{disabled:!0,class:"Checkbox Checkbox--plus",isRequired:!1})])):(c(),P("div",Ge,[(o=e.activityValues[i])!=null&&o.isAppointed?(c(),A(I,{key:0,class:"Checkbox Checkbox--minus",checked:(n=e.activityValues[i])==null?void 0:n.isModified,onChange:s=>e.updateRequestsValue(i,{isModified:(s==null?void 0:s.value)??0},e.AppConstants.seekAuthRemove)},null,8,["checked","onChange"])):M("",!0),(l=e.activityValues[i])!=null&&l.isAppointed?M("",!0):(c(),A(I,{key:1,class:"Checkbox Checkbox--plus",checked:(u=e.activityValues[i])==null?void 0:u.hasPendingApplication,onChange:s=>e.updateRequestsValue(i,{hasPendingApplication:(s==null?void 0:s.value)??0},e.AppConstants.seekAuthAdd)},null,8,["checked","onChange"]))]))]}),"cell-annualFeeIncome":r(({item:h,item:{product:i},id:o})=>{var n,l,u,s;return[i==="add-more"?(c(),A(V,{key:0,name:`annualFeeIncome-${i}`,id:e.setUniqueIdentifier(`-annualFeeIncome-${i}`),placeholder:"Enter Amount",hasLabel:!1,value:(n=e.newItems[o])==null?void 0:n.annualFeeIncome,minimumValue:new e.Money(0,"EUR"),isValueReactive:!0,isDataLoadedCompletely:!e.isInitializing,onOnValueChange:f=>e.attachNewItem(o,{annualFeeIncome:f??new e.Money(0,"EUR")})},null,8,["name","id","value","minimumValue","isDataLoadedCompletely","onOnValueChange"])):(c(),A(V,{key:1,name:`annualFeeIncome-${i}`,id:e.setUniqueIdentifier(`-annualFeeIncome-${i}`),placeholder:"Enter Amount",hasLabel:!1,disabled:!((l=e.activityValues[i])!=null&&l.isAppointed)&&!((u=e.activityValues[i])!=null&&u.isNewProduct),value:(s=e.activityValues[i])==null?void 0:s.annualFeeIncome,minimumValue:new e.Money(0,"EUR"),isValueReactive:!0,isDataLoadedCompletely:!e.isInitializing,onOnValueChange:f=>e.updateValue(i,{annualFeeIncome:f??new e.Money(0,"EUR")})},null,8,["name","id","disabled","value","minimumValue","isDataLoadedCompletely","onOnValueChange"]))]}),"cell-annualCommissionIncome":r(({item:h,item:{product:i},id:o})=>{var n,l,u,s;return[i==="add-more"?(c(),A(V,{key:0,name:`annualCommissionIncome-${i}`,id:e.setUniqueIdentifier(`-annualCommissionIncome-${i}`),placeholder:"Enter Amount",hasLabel:!1,value:(n=e.newItems[o])==null?void 0:n.annualCommissionIncome,minimumValue:new e.Money(0,"EUR"),isValueReactive:!0,isDataLoadedCompletely:!e.isInitializing,onOnValueChange:f=>e.attachNewItem(o,{annualCommissionIncome:f??new e.Money(0,"EUR")})},null,8,["name","id","value","minimumValue","isDataLoadedCompletely","onOnValueChange"])):(c(),A(V,{key:1,name:`annualCommissionIncome-${i}`,id:e.setUniqueIdentifier(`-annualCommissionIncome-${i}`),placeholder:"Enter Amount",hasLabel:!1,disabled:!((l=e.activityValues[i])!=null&&l.isAppointed)&&!((u=e.activityValues[i])!=null&&u.isNewProduct),value:(s=e.activityValues[i])==null?void 0:s.annualCommissionIncome,minimumValue:new e.Money(0,"EUR"),isValueReactive:!0,isDataLoadedCompletely:!e.isInitializing,onOnValueChange:f=>e.updateValue(i,{annualCommissionIncome:f??new e.Money(0,"EUR")})},null,8,["name","id","disabled","value","minimumValue","isDataLoadedCompletely","onOnValueChange"]))]}),"cell-hasLimitation":r(({item:h,item:{product:i},id:o})=>{var n,l,u;return[i==="add-more"?(c(),A(q,{key:0,id:e.setUniqueIdentifier(`-limitation-${i}`),name:`limitation-${i}`,"is-required":!1,"no-text":"",isValueReactive:!0,isDataLoadedCompletely:!e.isInitializing,value:((n=e.newItems[o])==null?void 0:n.hasLimitation)??!1,onOnValueChange:s=>e.attachNewItem(o,{hasLimitation:s})},null,8,["id","name","isDataLoadedCompletely","value","onOnValueChange"])):(c(),A(q,{key:1,id:e.setUniqueIdentifier(`-limitation-${i}`),name:`limitation-${i}`,"is-required":!1,disabled:!((l=e.activityValues[i])!=null&&l.isAppointed),"no-text":"",isValueReactive:!0,isDataLoadedCompletely:!e.isInitializing,value:((u=e.activityValues[i])==null?void 0:u.hasLimitation)??!1,onOnValueChange:s=>e.updateValue(i,{hasLimitation:s})},null,8,["id","name","disabled","isDataLoadedCompletely","value","onOnValueChange"]))]}),"expanded-content":r(({item:h,item:{product:i},id:o})=>{var n,l,u,s,f;return[g("div",He,[i==="add-more"&&((n=e.newItems[o])!=null&&n.hasLimitation)?(c(),A(v,{key:0,id:e.setUniqueIdentifier(`-limitations-${i}-1`),name:`limitations-${i}`,class:"col-custom-activities",placeholder:"Please Type Limitations",value:(l=e.newItems[o])==null?void 0:l.limitations,isRequired:!1,isValueReactive:!0,isDataLoadedCompletely:!e.isInitializing,"model-value":((u=e.newItems[o])==null?void 0:u.limitations)??"","onUpdate:modelValue":E=>e.attachNewItem(o,{limitations:E})},null,8,["id","name","value","isDataLoadedCompletely","model-value","onUpdate:modelValue"])):M("",!0),(s=e.activityValues[i])!=null&&s.hasLimitation?(c(),A(v,{key:1,id:e.setUniqueIdentifier(`-limitations-${i}-2`),name:`limitations-${i}`,class:"col-custom-activities",placeholder:"Please Type Limitations",value:(f=e.activityValues[i])==null?void 0:f.limitations,isRequired:!1,onOnValueChange:E=>e.updateValue(i,{limitations:E})},null,8,["id","name","value","onOnValueChange"])):M("",!0)])]}),"cell-action":r(({item:h,item:{product:i},id:o})=>{var n;return[i==="add-more"?(c(),P("div",We,[g("button",{class:"AddButton",onClick:te(l=>e.addNewItem(o),["prevent"])},[C(B,{symbol:"add-circle-27",size:"20"})],8,Ye)])):(n=e.activityValues[i])!=null&&n.isNewProduct?(c(),P("div",Ze,[g("button",{class:"DeleteButton",onClick:te(l=>e.deleteItem(i),["prevent"])},[C(B,{symbol:"trash",class:"text-error",size:"20"})],8,Je)])):M("",!0)]}),"footer-cell-product":r(()=>[Qe]),"footer-cell-annualFeeIncome":r(({id:h})=>[g("div",Xe,[g("span",xe,z(e.formatMoney(e.getTotal(h,"annualFeeIncome"))),1)])]),"footer-cell-annualCommissionIncome":r(({id:h})=>[g("div",ei,[g("span",ii,z(e.formatMoney(e.getTotal(h,"annualCommissionIncome"))),1)])]),_:2},1032,["id","columns","data"])]),_:1},8,["items"])]),_:1})]),_:1},512)]),_:1})],64)}const oi=qe(Oe,[["render",ti],["__scopeId","data-v-d9956480"]]);export{oi as default};
