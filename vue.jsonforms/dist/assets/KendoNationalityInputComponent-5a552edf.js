import{j as N,l as k,u as S,cX as v,A as c,_ as B,o as p,m as F,n as s,w as o,r as g,x as m,y as O,z as L,P as y,q as j,L as w,a_ as E,S as D,Q as $,N as T,cY as z,E as M,B as P}from"./index-9d6d511f.js";const R=N({name:"KendoNationalityInputComponent",props:{name:{type:String,default:""},id:String,label:{type:String,default:""},placeholder:{type:String,default:""},isRequired:{type:Boolean,default:!0},value:{type:Array,default:[]},optionalText:{type:String,default:"Optional"},isValueReactive:{type:Boolean,default:!1},isDataLoadedCompletely:{type:Boolean,default:!1}},data(){return{isFieldValidOnFirstLoad:!1,eventBus:k("$eventBusService"),nationalitiesWithFlags:[],nationalities:[],valuesAsObjectInternal:[],additionalNationality:"",isDropdownOpened:!1,isAddingOther:!1,isUnmounted:!1,errorMessage:""}},computed:{computedPlaceholder(){return this.$t("common-placeholder-text-dropdown")?this.$t("common-placeholder-text-dropdown"):this.placeholder}},watch:{isDataLoadedCompletely(e,t){return e==t||(this.isFieldValidOnFirstLoad=this.validate(this.value)==""),e}},setup(){const e=S(),{addComponentValidationValue:t,removeValidationValueByFieldId:a}=e;return{addComponentValidationValue:t,removeValidationValueByFieldId:a}},async created(){await this.setupFlags(),this.initValue(this.value),!this.isValueReactive&&(this.isFieldValidOnFirstLoad=this.validate(this.value)=="")},mounted(){this.isUnmounted=!1,this.isValueReactive&&this.isDataLoadedCompletely&&(this.isFieldValidOnFirstLoad=this.validate(this.value)=="")},async updated(){this.isFieldValidOnFirstLoad=this.validate(this.value)=="",await this.setupFlags(),this.initValue(this.value)},unmounted(){this.id&&(this.removeValidationValueByFieldId(this.id),this.isUnmounted=!0)},methods:{async setupFlags(){const e=await v.get("/api/country-nationalities.json");let t=JSON.parse(JSON.stringify(e.data));this.nationalities=t.map(i=>({countryCode:i.alpha_2_code,nationality:i.nationality}));const a=await v.get("/api/countries-all.json"),f=JSON.parse(JSON.stringify(a.data)).map(i=>{var l,r;return{name:(l=i.name)==null?void 0:l.common,flag:(r=i.flags)==null?void 0:r.svg,code:i.cca2,nationality:this.getNationality(i.cca2)}});this.nationalitiesWithFlags=f.filter(i=>i.nationality).slice().sort((i,l)=>{const r=this.getFirstNationality(i.nationality),d=this.getFirstNationality(l.nationality);return r.localeCompare(d)})},initValue(e){this.valuesAsObjectInternal=[];for(const t of e){const a=this.nationalitiesWithFlags.find(h=>h.nationality.startsWith(t));this.valuesAsObjectInternal.push({nationality:t,flag:(a==null?void 0:a.flag)??"",code:(a==null?void 0:a.code)??"",name:(a==null?void 0:a.name)??""})}},getNationality(e){var a;if(!e)return"NO COUNTRY CODE";const t=(a=this.nationalities)==null?void 0:a.find(h=>h.countryCode===e);return(t==null?void 0:t.nationality)??""},getFlagSvg(e){return`https://hatscripts.github.io/circle-flags/flags/${e.toLowerCase()}.svg`},getFirstNationality(e){var a;return e.includes(",")?(a=e.split(",")[0])==null?void 0:a.trim():e},onSelect(e){this.isFieldValidOnFirstLoad=!1,this.valuesAsObjectInternal=e.value,this.$emit("onValueChange",this.valuesAsObjectInternal.map(t=>t.nationality)),this.eventBus.emit(c.formFieldChangedEvent),this.eventBus.emit(c.formFieldPageLevelChangedEvent),this.isAddingOther=!1},validate(e){if(this.errorMessage="",this.isUnmounted)return"";if(!this.isRequired)return this.addIdKeyAndErrorValue(""),"";if(this.isFieldValidOnFirstLoad)return this.addIdKeyAndErrorValue(""),"";if(!e||e.length<1){const t=`Please enter a valid ${this.label}`;return this.addIdKeyAndErrorValue(t),this.errorMessage=t,t}return this.addIdKeyAndErrorValue(""),""},onItemClear(e){let t=this.valuesAsObjectInternal.indexOf(e);this.valuesAsObjectInternal.splice(t,1),this.$emit("onValueChange",this.valuesAsObjectInternal.map(a=>a.nationality)),this.eventBus.emit(c.formFieldChangedEvent),this.eventBus.emit(c.formFieldPageLevelChangedEvent),this.outFocusAddOther()},onFocus(){setTimeout(()=>this.isDropdownOpened=!0,100)},onBlur(){this.isAddingOther||(this.isDropdownOpened=!1)},onAddOtherClick(e){var t;this.isAddingOther=!0,(t=e.target)==null||t.focus()},onAddOther(){const e={nationality:this.additionalNationality,name:"",code:"",flag:""};this.nationalitiesWithFlags.push(e),this.valuesAsObjectInternal.push(e),this.$emit("onValueChange",this.valuesAsObjectInternal.map(t=>t.nationality)),this.eventBus.emit(c.formFieldChangedEvent),this.eventBus.emit(c.formFieldPageLevelChangedEvent),this.outFocusAddOther()},outFocusAddOther(){this.isAddingOther=!1,this.isDropdownOpened=!1},addIdKeyAndErrorValue(e){if(!this.id)return;const t=this.id;let a={};a[t]=e,this.addComponentValidationValue(t,a)}}});const K={key:0,class:"fineprint ms-1"},W=["src","alt"],q=["src","alt"],U=["onClick"];function J(e,t,a,h,f,i){const l=w,r=E,d=D,C=$,_=T,V=z,A=M,I=P;return p(),F("div",null,[s(I,{id:e.id,name:e.name,component:"myTemplate",validator:e.validate,class:"nationality-field"},{myTemplate:o(({props:u})=>[s(d,{orientation:"vertical",style:{gap:"6px"}},{default:o(()=>[s(l,{"editor-id":u.id,class:"control-label"},{default:o(()=>[g(m(e.label)+" ",1),e.isRequired?O("",!0):(p(),F("span",K," ("+m(e.optionalText)+") ",1))]),_:2},1032,["editor-id"]),s(V,L({ref:"multiselect"},u,{id:u.id,name:u.name,valid:!(u.touched&&e.errorMessage),placeholder:e.computedPlaceholder,value:e.valuesAsObjectInternal,opened:e.isDropdownOpened,size:"small",style:{"border-radius":"8px"},onChange:e.onSelect,onBlur:e.onBlur,onFocus:e.onFocus,"data-items":e.nationalitiesWithFlags,"text-field":"nationality","data-item-key":"code","item-render":"myTemplate","tag-render":"myTag",footer:"myFooter"}),{myTemplate:o(({props:n})=>[s(d,{class:"p-2",orientation:"horizontal",onClick:b=>n.onClick(b),gap:8,align:{horizontal:"start",vertical:"middle"}},{default:o(()=>[s(r,{value:n.selected},null,8,["value"]),y("img",{class:"flag-icon",src:e.getFlagSvg(n.dataItem.code),alt:n.dataItem.code},null,8,W),s(l,{class:"flex-grow-1"},{default:o(()=>[g(m(e.getFirstNationality(n.dataItem.nationality)),1)]),_:2},1024)]),_:2},1032,["onClick"])]),myTag:o(({props:n})=>[s(d,{class:"nationality-tag-item",orientation:"horizontal",align:{horizontal:"start",vertical:"middle"}},{default:o(()=>[y("img",{class:"flag-icon",src:e.getFlagSvg(n.tagData.data[0].code),alt:n.tagData.data[0].code},null,8,q),s(l,null,{default:o(()=>[g(m(e.getFirstNationality(n.tagData.text)),1)]),_:2},1024),y("span",{class:"k-icon k-i-close-circle tag-clear",onClick:()=>e.onItemClear(n.tagData.data[0])},null,8,U)]),_:2},1024)]),myFooter:o(()=>[s(d,{class:"nationality-footer",orientation:"horizontal",gap:8,align:{horizontal:"start",vertical:"middle"}},{default:o(()=>[s(C,{class:"flex-grow-1",isRequired:!1,value:e.additionalNationality,customStyle:{borderWidth:0},placeholder:"Other",onClick:e.onAddOtherClick,onFocusout:e.outFocusAddOther,onOnValueChange:t[0]||(t[0]=n=>e.additionalNationality=n)},null,8,["value","onClick","onFocusout"]),s(_,{class:"add-other-icon",symbol:"add-circle-27",size:"20",onClick:e.onAddOther},null,8,["onClick"])]),_:1})]),_:2},1040,["id","name","valid","placeholder","value","opened","onChange","onBlur","onFocus","data-items"]),u.touched&&e.errorMessage?(p(),j(A,{key:0},{default:o(()=>[g(m(e.errorMessage),1)]),_:1})):O("",!0)]),_:2},1024)]),_:1},8,["id","name","validator"])])}const G=B(R,[["render",J],["__scopeId","data-v-25fabf51"]]);export{G as _};
