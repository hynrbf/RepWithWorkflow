import{j as R,l as $,D,I as V,A as p,bj as B,bk as L,bl as f,a3 as b,_ as E,o as n,m as d,n as o,w as r,bg as G,bm as z,r as c,x as i,P as l,y as q,J as k,K as U,bn as K,bi as M,bo as O,bp as j,N as H,O as J,bq as W,a2 as Q,bs as X,br as Y}from"./index-9d6d511f.js";import{_ as Z,a as x}from"./rejected-grey-icon-2a930ba1.js";const ee=R({name:"ProvidersList",props:{providers:{type:Array,default:()=>[]}},data(){return{hasProviders:!1,columnMenu:!0,selectedField:"selected",expandField:"expanded",gridPageable:{buttonCount:5,info:!0,type:"numeric",pageSizes:!0,previousNext:!0},gridData:[],tasks:[],skip:0,take:7,group:[],sortParams:[],filter:null,isShowTasksModal:!1,fcaFirmRefNo:"",providerTableGroups:[{title:"Current",value:"current"},{title:"All",value:"all"}],activeProviderTableGroup:"current",providersInternal:[],selectedProducts:[],selectedStatus:{label:"",value:""},eventBus:$("$eventBusService"),helperService:D.resolve(V.name),itemsToPDF:[]}},mounted(){this.providersInternal=this.providers},unmounted(){this.eventBus.off(p.filterGridEvent)},computed:{ProviderRepresentative(){return B},ProviderIntroducerDetails(){return L},providersColumns(){return[{field:"details.name",title:"Provider Name",width:"200",resizable:!0},{field:"details.fcaFirmRefNo",title:"FRN",width:70,resizable:!0},{field:"praAuthorised",title:"PRA Authorised",resizable:!0},{field:"products",title:"Products",resizable:!0},{field:"introducer",title:"Provider Representative",resizable:!0},{field:"status",title:"Status"},{field:"tasks",title:"Tasks",width:70},{field:"actions",title:" ",className:"text-center"}]},columnsToPDF(){return this.providersColumns.filter(e=>e.field!=="actions")}},created(){const e=f(this.gridData,this.sortParams);this.$emit("exportingPDF",this.columnsToPDF,e),this.eventBus.on(p.filterGridEvent,()=>{this.skip!=0&&(this.skip=0)})},methods:{orderBy:f,closeForm(){this.isShowTasksModal=!1},emitAddNewProvider(){this.$emit("addNewProvider")},emitViewProviderFromList(e){this.$emit("viewProviderList",e)},emitEditProviderList(e){this.$emit("editProviderList",e)},emitViewTasksFromCard(e,s){this.$emit("viewTasksCard",e,s)},emitViewProviderFromCard(e){this.$emit("viewProviderCard",e)},emitProviderFromCard(e){this.$emit("editProviderCard",e)},emitFilterProvidersByProductsStatus(){this.providersInternal=this.providers.filter(e=>{const s=e.products.map(m=>m.name),a=this.selectedProducts.every(m=>s.includes(m)),u=e.status===this.selectedStatus.value;return a&&u})},emitSearchProvidersByNameFRN(e){if(!e){this.providersInternal=this.providers;return}this.providersInternal=this.providers.filter(s=>{if(!s.details.name||!s.details.fcaFirmRefNo)return!1;const a=s.details.name.toLowerCase().includes(e.toLowerCase()),u=s.details.fcaFirmRefNo.toLowerCase().includes(e.toLowerCase());return a||u})},emitClearFilters(){this.selectedProducts=[],this.selectedStatus={label:"",value:""}},emitCloseFilter(){this.providersInternal=this.providers,this.emitClearFilters()},exportToPdf(e){const s=this.formatProvidersPdfData(e);this.itemsToPDF=f(s,this.sortParams),this.$refs.gridPdfExport.save(this.itemsToPDF)},formatProvidersPdfData(e){return e.map(s=>{var a;return{...s,"details.name":`${(a=s.details)==null?void 0:a.name} `,"details.fcaFirmRefNo":s.details.fcaFirmRefNo,praAuthorised:s.details.praAuthorised,products:s.products,introducer:`${s.representative.forename} ${s.representative.surname}`,status:s.status,tasks:s.tasks}})},getProducts(){return b.getProducts()},getStatuses(){return b.getStatuses().map(e=>({label:e,value:e}))},handleStatusChange(e){this.selectedStatus=e},handleSort(e){this.sortParams=e.sort},handlePage(e){this.skip=e.page.skip,this.take=e.page.take},setUniqueIdentifier(e){return`${p.providersRoute}-list${e}`.replace(/\s+/g,"").replace("/","")}}});const te={class:"fca-firm-ref-no-cell"},se=["href"],re={key:0,src:Z,alt:"Authorised",title:"Authorised",width:"16",height:"16"},oe={key:1,src:x,alt:"Non-Authorised",title:"Non-Authorised",width:"16",height:"16"},ie={style:{"text-decoration":"underline"}},ae={class:"text-center"},ne={class:"row-name"},de={class:"d-inline-flex gap-2"},le={class:"row mt-2"};function ue(e,s,a,u,m,me){var C;const S=K,N=M,P=O,w=j,v=H,g=J,I=W,y=Q,A=X,T=Y;return n(),d(k,null,[o(N,{ref:"gridPdfExport"},{default:r(()=>[G(o(S,{"data-items":e.itemsToPDF,columns:e.providersColumns},null,8,["data-items","columns"]),[[z,!1]])]),_:1},512),o(T,{isSortable:"",columns:e.providersColumns,items:e.orderBy(e.providersInternal,e.sortParams).slice(e.skip,e.skip+e.take),groups:e.providerTableGroups,"no-actionbar":!1,"search-placeholder":"Search Name, FRN","add-button-text":"Add New Provider",activeGroup:e.activeProviderTableGroup,"onUpdate:activeGroup":s[1]||(s[1]=t=>e.activeProviderTableGroup=t),sort:e.sortParams,handleSortChange:e.handleSort,handlePageChange:e.handlePage,pageable:!0,skip:e.skip,take:e.take,total:((C=e.providersInternal)==null?void 0:C.length)??0,onAdd:e.emitAddNewProvider,onFilter:e.emitFilterProvidersByProductsStatus,onSearch:e.emitSearchProvidersByNameFRN,onClear:e.emitClearFilters,onClose:e.emitCloseFilter,onAddExport:e.exportToPdf},{"cell-details.name":r(({item:{details:t}})=>[o(P,{rounded:"full",type:"text",text:(t==null?void 0:t.name)??""},{text:r(()=>[c(i(t==null?void 0:t.name),1)]),_:2},1032,["text"])]),"cell-details.fcaFirmRefNo":r(({item:{details:t}})=>[l("div",te,[t!=null&&t.fcaFirmRefNo?(n(),d("a",{key:0,href:e.helperService.generateFCASearchUrl((t==null?void 0:t.fcaFirmRefNo)??""),target:"_blank",rel:"noopener noreferrer"},i(t==null?void 0:t.fcaFirmRefNo),9,se)):q("",!0)])]),"cell-praAuthorised":r(({item:{details:t}})=>[t!=null&&t.praAuthorised?(n(),d("img",re)):(n(),d("img",oe))]),"cell-products":r(({item:{products:t}})=>[c(i("")),l("span",ie,i((t==null?void 0:t.length)>1?"+2":""),1)]),"cell-introducer":r(({item:{representative:t}})=>[o(P,{rounded:"full",type:"text",text:`${t==null?void 0:t.forename} ${t==null?void 0:t.surname}`},{text:r(()=>[c(i(t==null?void 0:t.forename)+" "+i(t==null?void 0:t.surname),1)]),_:2},1032,["text"])]),"cell-status":r(({item:{status:t}})=>[o(w,{themeColor:t==="Complete"?"success-tint":"warning-tint"},{default:r(()=>[c(i(t),1)]),_:2},1032,["themeColor"])]),"cell-tasks":r(({item:{tasks:t}})=>[l("div",ae,[l("span",ne,i((t==null?void 0:t.length)??0),1)])]),"cell-actions":r(({item:{id:t}})=>[l("div",de,[o(g,{type:"button",size:"small",rounded:"full",shape:"square","theme-color":"light",title:"View",class:"ActionButton",onClick:h=>e.emitViewProviderFromList(t)},{default:r(()=>[o(v,{symbol:"eye",size:"20"})]),_:2},1032,["onClick"]),o(g,{type:"button",size:"small",rounded:"full",shape:"square","theme-color":"light",title:"Edit",class:"ActionButton",onClick:h=>e.emitEditProviderList(t)},{default:r(()=>[o(v,{symbol:"edit-pen",size:"20"})]),_:2},1032,["onClick"])])]),"filter-fields":r(()=>[o(I,{name:"products",id:e.setUniqueIdentifier("-products"),label:"Products",class:"mb-3",dataItems:e.getProducts(),isRequired:!1,value:e.selectedProducts,onOnValueChange:s[0]||(s[0]=t=>{e.selectedProducts=t})},null,8,["id","dataItems","value"]),o(y,{name:"status",id:e.setUniqueIdentifier("-status"),label:"Status",class:"mb-3",dataItems:e.getStatuses(),value:e.selectedStatus,isRequired:!1,onOnValueChange:e.handleStatusChange},null,8,["id","dataItems","value","onOnValueChange"])]),card:r(()=>[l("div",le,[(n(!0),d(k,null,U(e.providers,(t,h)=>{var _,F;return n(),d("div",{class:"col-lg-4",key:t.id},[o(A,{cardId:t.id,cardName:(_=t.details)==null?void 0:_.name,cardfcaFirmRefNo:(F=t.details)==null?void 0:F.fcaFirmRefNo,cardTasks:t.tasks,cardIndex:h,onViewProvider:e.emitViewProviderFromCard,onEditProvider:e.emitProviderFromCard,onViewTasks:e.emitViewTasksFromCard},null,8,["cardId","cardName","cardfcaFirmRefNo","cardTasks","cardIndex","onViewProvider","onEditProvider","onViewTasks"])])}),128))])]),_:1},8,["columns","items","groups","activeGroup","sort","handleSortChange","handlePageChange","skip","take","total","onAdd","onFilter","onSearch","onClear","onClose","onAddExport"])],64)}const pe=E(ee,[["render",ue],["__scopeId","data-v-7db11fbe"]]);export{pe as default};
