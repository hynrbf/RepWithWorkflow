import{bb as ce,aV as N,b1 as q,b6 as z,a3 as ne,j as O,o as f,m as w,n as o,w as a,H as K,q as M,P as i,y as se,N as H,O as W,A as p,_ as oe,C as ue,G as Z,am as ie,Z as me,aW as ye,aX as pe,r as ae,x as b,Q as fe,U as he,ba as _e,aU as be,J as P,K as G,l as J,D as Q,ac as Se,ag as ge,b3 as X,b4 as Y,bc as ee,bd as ve,be as Ce,au as D,av as I,as as we,aA as x,bf as $e,bg as Ae,aC as ke,aG as Ve,bh as Be,aZ as Ee,b9 as Te,a5 as Le,a6 as Me,W as Ue}from"./index-9d6d511f.js";import{S as Ne,a as Re,_ as Fe,b as De}from"./RichTextComponent-eef846c8.js";import{_ as le,a as Ie}from"./ModalComponent.vue_vue_type_script_setup_true_lang-fe9b98ed.js";import{_ as ze}from"./OverlayLoader-e5a9021a.js";import{_ as re}from"./StatusLabelComponent.vue_vue_type_script_setup_true_lang-90f1f182.js";import{_ as Pe}from"./ContentListBoxComponent.vue_vue_type_style_index_0_lang-738fb067.js";import{_ as Oe}from"./GridCardTable-248623f7.js";import{_ as je}from"./DateTimeComponent-2c5db54c.js";const te=ce("arStationeryStore",{state:()=>({stationery:void 0,stationeries:[]}),getters:{},actions:{setStationery(e){this.stationery=e},getStationery(e,n=!0){const s=this.stationeries.find(t=>t.id===e);return n&&(this.stationery=s),s},appendStationery(e){return this.stationeries=[...this.stationeries,e],e},async fetchStationeriesAsync(){const e=N(),{fetchArCustomerByEmailAsync:n}=e,{currentArCustomer:s}=q(e);try{await n(s.value.email);const{stationeries:t}=s.value;this.stationeries=z(t)?ne.getDefaultStationeries():t}catch(t){return Promise.reject(t)}},async createStationeryAsync(e,n=!0){const s=N(),{updateCustomerArByEmailAsync:t}=s,{currentArCustomer:c}=q(s);try{const l=c.value.email;let u=c.value.stationeries||[];if(!l)throw new Error("Email not defined.");const m={...e};u=z(u)?[...this.stationeries,m]:[...u,m],await t(l,{stationeries:u}),n&&this.appendStationery(m)}catch(l){return Promise.reject(l)}},async updateStationeryAsync(e,n,s=!0){const t=N(),{updateCustomerArByEmailAsync:c}=t,{currentArCustomer:l}=q(t);try{const u=l.value.email,m=l.value.stationeries||[];if(!u)throw new Error("Email not defined.");const h=m.findIndex(S=>S.id===e);h!==-1&&m.splice(h,1,n),await c(u,{stationeries:m}),s&&(this.stationeries=m)}catch(u){return Promise.reject(u)}}}}),qe={class:"d-inline-flex gap-2"},xe=["href"],Ke={class:"k-button-text"},Ge=O({__name:"ARActions",props:{stationery:{},disabled:{type:Boolean}},emits:["view","upload"],setup(e,{emit:n}){return(s,t)=>{var u,m,h,S,v,y;const c=H,l=W;return f(),w("div",qe,[o(l,{type:"button",size:"small",rounded:"full",shape:"square","theme-color":"light",title:"View",class:"ActionButton",onClick:t[0]||(t[0]=_=>n("view",`${s.stationery.id}`,K(p).viewAction)),disabled:!((m=(u=s.stationery)==null?void 0:u.files)!=null&&m.length)},{default:a(()=>[o(c,{symbol:"eye",size:"20"})]),_:1},8,["disabled"]),o(l,{type:"button",size:"small",rounded:"full",shape:"square","theme-color":"light",title:"Upload",class:"ActionButton",onClick:t[1]||(t[1]=_=>n("upload",`${s.stationery.id}`))},{default:a(()=>[o(c,{symbol:"upload-file-28",size:"20"})]),_:1}),s.stationery&&s.stationery.files&&(s.stationery.files.length===0||s.stationery.files.length>1)?(f(),M(l,{key:0,type:"button",size:"small",rounded:"full",shape:"square","theme-color":"light",title:"Download",class:"ActionButton",disabled:!((S=(h=s.stationery)==null?void 0:h.files)!=null&&S.length),onClick:t[2]||(t[2]=_=>n("view",`${s.stationery.id}`,K(p).downloadAction))},{default:a(()=>[o(c,{symbol:"download-box-2-19",size:"20"})]),_:1},8,["disabled"])):s.stationery&&((v=s.stationery)!=null&&v.files)&&((y=s.stationery)==null?void 0:y.files.length)==1?(f(),w("a",{key:1,href:`${s.stationery.files[0].url}`,target:"_blank",class:"k-button k-button-sm k-button-square k-rounded-full k-button-solid k-button-solid-light ActionButton disabled"},[i("span",Ke,[o(c,{symbol:"download-box-2-19",size:"20"})])],8,xe)):se("",!0)])}}});const He=oe(Ge,[["__scopeId","data-v-b625e6be"]]),We={class:"text-right"},Ze=O({__name:"ARStationeryModal",props:{initialValues:{},saving:{type:Boolean}},emits:["submit","update"],setup(e,{emit:n}){const s=e,{initialValues:t}=ue(s),c=Z(),l=Z(),u=ie(),{changeLifeCycleName:m}=u,h=me(()=>!z(t==null?void 0:t.value)),S=y=>{y.files&&(y.files=y.files.map(({uid:_="",id:C="",name:k="",extension:V="",size:A=0,uploadedUrl:B="",url:E=""})=>({id:C||_||"",name:k,extension:V,size:A,url:B||E}))),h.value?n("update",{...y}):n("submit",{...y}),l.value.reset()};ye(()=>{m(p.pageLifeCycleNameCreated)}),pe(()=>{m(p.pageLifeCycleNameMounted)});const v=y=>`${p.arStationeryRoute}-stationaryModal${y}`.replace(/\s+/g,"").replace("/","");return(y,_)=>{const C=fe,k=he,V=ze,A=_e,B=be,E=W,L=le;return f(),M(L,{ref_key:"modalElement",ref:c,title:`${h.value?"Edit":"Add"} Stationery`},{footer:a(()=>[i("div",We,[o(E,{type:"button","theme-color":"primary",disabled:y.saving,onClick:_[0]||(_[0]=T=>l.value.submit())},{default:a(()=>[ae(b(h.value?"Save Changes":"Save & Add"),1)]),_:1},8,["disabled"])])]),default:a(()=>[o(B,{initialValues:K(t),onSubmit:S},{default:a(()=>[o(A,{ref_key:"formElement",ref:l},{default:a(({form:T})=>[o(V,{loading:y.saving},{default:a(()=>[o(C,{id:v("-name"),name:"name",label:"Stationery Name",class:"mb-3",value:T.values.name},null,8,["id","value"]),o(k,{label:"Upload File",name:"files",optionalText:"(Accepted file types: pdf, jpg, png, mp4, mov,  Maximum 25 MB file size)",stretched:"",multiple:"",dropzone:"",value:T.values.files,isRequired:!1,"allowed-extensions":[".pdf",".jpg",".png",".gif",".webp",".jpeg",".mov",".mp4"]},null,8,["value","allowed-extensions"])]),_:2},1032,["loading"])]),_:1},512)]),_:1},8,["initialValues"])]),_:1},8,["title"])}}}),Je={class:"text-center"},Qe={key:0,class:"file-container"},Xe={class:"image-container"},Ye=["src","alt"],et={class:"file-list"},tt=["src"],nt={class:"document-name"},st=["href"],ot={class:"k-button-text"},it={key:1},at={class:"image-container"},lt=["src","alt"],rt=["src"],dt={class:"document-name"},ct=["href"],ut={class:"k-button-text"},mt={key:1},yt=["src"],pt={class:"document-name"},ft=["href"],ht={class:"k-button-text"},_t={class:"text-center justify-content-center"},bt=O({__name:"ARViewStationeryModal",props:{stationery:{},isView:{type:Boolean}},emits:["update"],setup(e,{emit:n}){const s=(t,c)=>{c.files&&(c.files=c==null?void 0:c.files.filter(l=>l.id!==t)),n("update",{...c})};return(t,c)=>{var v,y;const l=H,u=W,m=Ne,h=re,S=le;return f(),M(S,{width:"600",height:"360",hasIconTitle:!0,iconTitle:(v=t.stationery)==null?void 0:v.icon,title:(y=t.stationery)==null?void 0:y.name,class:"view-stationery"},{footer:a(()=>{var _,C;return[i("div",_t,[t.stationery&&((_=t.stationery)!=null&&_.files)&&((C=t.stationery)==null?void 0:C.files.length)<=1?(f(),M(h,{key:0,status:t.stationery.status},null,8,["status"])):se("",!0)])]}),default:a(()=>{var _,C,k,V,A,B,E,L,T,R,F;return[i("div",Je,[t.isView?(f(),w("div",Qe,[t.stationery&&((_=t.stationery)!=null&&_.files)&&((C=t.stationery)==null?void 0:C.files.length)>1?(f(),M(m,{key:0,style:{width:"560px",height:"240px"},"data-items":(k=t.stationery)==null?void 0:k.files,content:"content",endless:!0},{content:a(({props:d})=>[i("div",Xe,[i("img",{src:d.item.url,alt:`File ${d.item.name}`,draggable:!1},null,8,Ye)]),i("div",et,[i("img",{src:`/file-${d.item.extension}-v2.svg`,width:"23",height:"24"},null,8,tt),i("span",nt,b(`${d.item.name}.${d.item.extension}`),1),i("a",{href:`${d.item.url}`,target:"_blank",class:"k-button k-button-sm k-button-square k-rounded-full k-button-solid k-button-solid-light action-button"},[i("span",ot,[o(l,{symbol:"download-box-2-19",size:"20"})])],8,st),o(u,{type:"button",size:"small",rounded:"full",shape:"square","theme-color":"light",title:"Delete",class:"action-button",onClick:r=>t.stationery&&s((d==null?void 0:d.item.id)??"",t.stationery)},{default:a(()=>[o(l,{symbol:"trash",class:"text-error",size:"20"})]),_:2},1032,["onClick"])])]),_:1},8,["data-items"])):(f(),w("div",it,[i("div",at,[i("img",{src:((B=(A=(V=t.stationery)==null?void 0:V.files)==null?void 0:A[0])==null?void 0:B.url)||"",alt:`File ${((T=(L=(E=t.stationery)==null?void 0:E.files)==null?void 0:L[0])==null?void 0:T.name)??""}`},null,8,lt)]),(f(!0),w(P,null,G((R=t.stationery)==null?void 0:R.files,(d,r)=>(f(),w("div",{class:"file-list",key:r},[i("img",{src:`/file-${d.extension}-v2.svg`,width:"23",height:"24"},null,8,rt),i("span",dt,b(`${d.name}.${d.extension}`),1),i("a",{href:`${d.url}`,target:"_blank",class:"k-button k-button-sm k-button-square k-rounded-full k-button-solid k-button-solid-light action-button"},[i("span",ut,[o(l,{symbol:"download-box-2-19",size:"20"})])],8,ct),o(u,{type:"button",size:"small",rounded:"full",shape:"square","theme-color":"light",title:"Delete",class:"action-button",onClick:g=>t.stationery&&s((d==null?void 0:d.id)??"",t.stationery)},{default:a(()=>[o(l,{symbol:"trash",class:"text-error",size:"20"})]),_:2},1032,["onClick"])]))),128))]))])):(f(),w("div",mt,[(f(!0),w(P,null,G((F=t.stationery)==null?void 0:F.files,(d,r)=>(f(),w("div",{class:"file-list",key:r},[i("img",{src:`/file-${d.extension}-v2.svg`,width:"23",height:"24"},null,8,yt),i("span",pt,b(`${d.name}.${d.extension}`),1),i("a",{href:`${d.url}`,target:"_blank",class:"k-button k-button-sm k-button-square k-rounded-full k-button-solid k-button-solid-light action-button"},[i("span",ht,[o(l,{symbol:"download-box-2-19",size:"20"})])],8,ft)]))),128))]))])]}),_:1},8,["iconTitle","title"])}}});const St=O({name:"Stationery",components:{Actions:He,ARStationeryModal:Ze,ARViewStationeryModal:bt},data(){return{currentTab:0,tabs:[{title:this.$t("stationaryPage-stationery"),content:"stationery"},{title:this.$t("stationaryPage-disclosures"),content:"disclosures"}],isStationeryModalVisible:!1,isSavingStationery:!1,isLoading:!1,eventBus:J("$eventBusService"),eventBusFormSaved:J("$eventBusService"),appService:Q.resolve(Se.name),userSubmittedChangesService:Q.resolve(ge.name),isSavingAlertOpened:!1,isViewStationeryModalVisible:!1,isFetchingStationery:!1,isActionView:!0,isViewFileDownloadModalVisible:!1,disclosure:ne.getDefaultDisclosure()}},computed:{...X(N,["currentArCustomer","currentArFirmName"]),...X(te,["stationery","stationeries"]),stationeryColumns(){return[{field:"stationeryName",title:"Stationery Name",width:300},{field:"filesUploaded",title:"Files Uploaded",className:"text-center"},{field:"status",title:"Status",className:"text-center"},{field:"lastUpdated",title:"Last Updated"},{field:"actions",title:" ",className:"text-center",width:160}]},disclosureTypes(){return p.disclosureTypes},disclosuresNav(){return this.disclosureTypes.map(e=>(e.label=e.title,e.anchorTo=e.id,e))},disclosuresListBox(){return Object.fromEntries(this.disclosureTypes.map(e=>{const{id:n,title:s}=e;return[n,[{id:`${n}Text`,title:`Text for ${s}`,initialItems:[],emptyText:"Text"},{id:`${n}ConfirmedText`,title:`Confirmed Text for ${s}`,initialItems:[],isFeatured:!0,noAdd:!0,emptyText:"Confirmed Text",keepEditting:!0}]]}))},selectedStationery(){return this.stationery}},async mounted(){this.isLoading=!0,this.setInitialValues(),this.isLoading=!1,this.eventBus.emit(p.bottomBarEnableEvent,!0),this.eventBusFormSaved.on(p.formSavedEvent,e=>this.handleSubmit(e)),this.$watch(e=>[e.stationery,e.stationeries,e.disclosure],()=>{this.eventBus.emit(p.formFieldChangedEvent),this.eventBus.emit(p.formFieldPageLevelChangedEvent)},{deep:!0}),this.changeLifeCycleName(p.pageLifeCycleNameMounted)},unmounted(){this.eventBus.emit(p.bottomBarEnableEvent,!1),this.eventBusFormSaved.off(p.formSavedEvent),this.isLoading=!1},created(){this.changeLifeCycleName(p.pageLifeCycleNameCreated),this.eventBus.on(p.formFieldChangedEvent,()=>{this.userSubmittedChangesService.hasUserSubmittedChangesToRemoteApi=!1})},setup(){const e=ie(),{changeLifeCycleName:n}=e;return{changeLifeCycleName:n}},methods:{...Y(N,["updateCustomerArByEmailAsync"]),...Y(te,["createStationeryAsync","updateStationeryAsync","fetchStationeriesAsync","getStationery","setStationery"]),moment:ee,selectTab(e){this.currentTab=e.selected},fetchDisclosure(){const{disclosure:e}=this.currentArCustomer;z(e)||(this.disclosure=Object.fromEntries(Object.entries(e).map(([n,s])=>[n,(s||[]).map(t=>({content:t}))])))},async setInitialValues(){await Promise.all([this.fetchStationeriesAsync(),this.fetchDisclosure()])},viewStationery(e,n){this.isViewStationeryModalVisible=!0,this.isFetchingStationery=!0,this.getStationery(e,!0),this.isFetchingStationery=!1,this.isActionView=n===p.viewAction},uploadStationery(e){this.isStationeryModalVisible=!0,this.isFetchingStationery=!0,this.getStationery(e,!0),this.isFetchingStationery=!1},clearStationery(){this.setStationery(void 0)},async saveStationeryAsync(e){const n=new Re,s=ee().unix();n.id=ve(),n.name=e.name,n.icon="clipboard-text-22",n.status=Ce.Pending,n.files=e.files||[],n.createdAt=s,n.updatedAt=s;try{await this.createStationeryAsync(n),this.isStationeryModalVisible=!1,this.isSavingStationery=!1,this.clearStationery()}catch{D({type:I.ERROR,content:"Something went wrong.",interval:4e3})}},async updateStationeryDataAsync(e){try{await this.updateStationeryAsync((e==null?void 0:e.id)??"",e,!0),this.isViewStationeryModalVisible=!1,this.isStationeryModalVisible=!1,this.isSavingStationery=!1,this.clearStationery()}catch{D({type:I.ERROR,content:"Something went wrong.",interval:4e3})}},handleSubmit(e){var n,s,t,c;this.isSavingAlertOpened||(we({title:this.$t("common-alert-title"),content:this.$t("common-alert-content"),confirmButtonText:this.$t("common-alert-buttonText"),onConfirm:async()=>{const{email:l}=this.currentArCustomer;if(l){this.isLoading=!0,this.userSubmittedChangesService.hasUserSubmittedChangesToRemoteApi=!0,this.isSavingAlertOpened=!1;try{const u=Object.fromEntries(Object.entries(this.disclosure).map(([h,S])=>[h,S.map(({content:v})=>v)]));await this.updateCustomerArByEmailAsync(l,{disclosure:u,stationeries:this.stationeries});const m=4e3;D({type:I.SUCCESS,content:"Saved successfully.",interval:m}),e&&setTimeout(()=>this.eventBus.emit(p.autoNextEvent),m)}catch{D({type:I.ERROR,content:"Something went wrong.",interval:4e3})}this.isLoading=!1}},onCancel:()=>{this.isSavingAlertOpened=!1},onClose:()=>{this.isSavingAlertOpened=!1}}),this.isSavingAlertOpened=!0,(c=(t=(s=(n=this.$refs)==null?void 0:n.formElement)==null?void 0:s.$el)==null?void 0:t.requestSubmit)==null||c.call(t))}},watch:{disclosure:{handler(){this.eventBus.emit(p.formFieldChangedEvent),this.eventBus.emit(p.formFieldPageLevelChangedEvent)},deep:!0}}}),gt=e=>(Le("data-v-f6841402"),e=e(),Me(),e),vt={class:"font-size-xl text-primary mb-3"},Ct={class:"alert alert-primary border-0"},wt={class:"font-size-default"},$t={class:"d-flex align-items-center mb-3"},At={class:"flex-grow-1"},kt={class:"font-size-default"},Vt={class:"flex-shrink-1"},Bt={class:"d-flex align-items-center justify-content-between"},Et={class:"font-size-xl text-primary mb-3"},Tt={class:"alert alert-primary border-0"},Lt=gt(()=>i("div",{class:"mb-3"},null,-1)),Mt=["innerHTML"],Ut={class:"text-center text-neutral"},Nt={class:"mt-2"};function Rt(e,n,s,t,c,l){const u=ke,m=Ve,h=Ie,S=re,v=je,y=x("Actions"),_=Be,C=Oe,k=Ee,V=H,A=Fe,B=De,E=Pe,L=Ue,T=Te,R=x("ARStationeryModal"),F=x("ARViewStationeryModal"),d=$e("sticky");return f(),w(P,null,[o(u,{isLoading:e.isLoading},null,8,["isLoading"]),o(m),o(T,{class:"TabStrip TabStrip--lined",selected:e.currentTab,tabs:e.tabs,onSelect:e.selectTab},{stationery:a(()=>[i("h2",vt,b(e.$t("ar-stationaryPage-stationery")),1),i("p",null,[i("div",Ct,b(e.$t("ar-stationaryPage-stationeryDescription",{currentFirmName:e.currentArFirmName})),1)]),o(C,{columns:e.stationeryColumns,items:e.stationeries,class:"stationeries-table mt-4","add-button-text":"Add Stationery",onAdd:n[0]||(n[0]=r=>e.isStationeryModalVisible=!0)},{"cell-stationeryName":a(({item:{name:r,icon:g}})=>[o(h,{icon:g},{text:a(()=>[i("strong",wt,b(r),1)]),_:2},1032,["icon"])]),"cell-filesUploaded":a(({item:{files:r}})=>[ae(b(r.length),1)]),"cell-status":a(({item:{status:r}})=>[o(S,{status:r},null,8,["status"])]),"cell-lastUpdated":a(({item:{updatedAt:r}})=>[o(v,{value:e.moment(r*1e3).toDate()},null,8,["value"])]),"cell-actions":a(({item:r})=>[o(y,{stationery:r,onView:e.viewStationery,onUpload:e.uploadStationery,onDownload:e.viewStationery},null,8,["stationery","onView","onUpload","onDownload"])]),"card-content":a(({item:{id:r,name:g,icon:$,status:U,files:j,updatedAt:de}})=>[i("div",$t,[i("div",At,[o(h,{icon:$},{text:a(()=>[i("strong",kt,b(g),1),o(_),i("small",null,b(j.length)+" "+b(j.length>1?"files":"file"),1)]),_:2},1032,["icon"])]),i("div",Vt,[o(S,{status:U},null,8,["status"])])]),i("div",Bt,[i("small",null,[o(v,{value:de},null,8,["value"])]),o(y,{stationery:{id:r,files:j},onView:e.viewStationery,onUpload:e.uploadStationery,onDownload:e.viewStationery},null,8,["stationery","onView","onUpload","onDownload"])])]),_:1},8,["columns","items"])]),disclosures:a(()=>[i("h2",Et,b(e.$t("ar-stationaryPage-disclosures")),1),i("div",Tt,b(e.$t("ar-stationaryPage-disclosuresDescription")),1),Ae(o(k,{items:e.disclosuresNav,anchorable:""},null,8,["items"]),[[d,{marginTop:55,stickyClass:"is-bg-from-body is-zindex-base"}]]),Lt,(f(!0),w(P,null,G(e.disclosureTypes,r=>(f(),M(L,{key:`disclosure-${r.id}`,id:r.id,title:r.title,class:"DisclosurePanel"},{description:a(()=>[i("div",{innerHTML:r.description,class:"alert alert-primary border-0"},null,8,Mt)]),default:a(()=>[o(E,{modelValue:e.disclosure,"onUpdate:modelValue":n[1]||(n[1]=g=>e.disclosure=g),blocks:e.disclosuresListBox[r.id]},{empty:a(({blockId:g,emptyText:$})=>[i("div",Ut,[o(V,{size:"27",symbol:"text-square-17"}),i("div",Nt,b($),1)])]),"create-form":a(({setValue:g,getValue:$})=>[o(A,{"model-value":$("content",""),"onUpdate:modelValue":U=>g("content",U)},null,8,["model-value","onUpdate:modelValue"])]),"item-edit-footer":a(({getValue:g,setValue:$})=>[o(A,{"model-value":g("content"),"onUpdate:modelValue":U=>$("content",U)},null,8,["model-value","onUpdate:modelValue"])]),"item-content":a(({props:g})=>{var $;return[o(B,{text:($=g.dataItem)==null?void 0:$.content},null,8,["text"])]}),_:2},1032,["modelValue","blocks"])]),_:2},1032,["id","title"]))),128))]),_:1},8,["selected","tabs","onSelect"]),o(R,{modelValue:e.isStationeryModalVisible,"onUpdate:modelValue":n[2]||(n[2]=r=>e.isStationeryModalVisible=r),initialValues:e.stationery,saving:e.isSavingStationery,onSubmit:e.saveStationeryAsync,onUpdate:e.updateStationeryDataAsync,onClose:e.clearStationery},null,8,["modelValue","initialValues","saving","onSubmit","onUpdate","onClose"]),o(F,{modelValue:e.isViewStationeryModalVisible,"onUpdate:modelValue":n[3]||(n[3]=r=>e.isViewStationeryModalVisible=r),stationery:e.selectedStationery,isView:e.isActionView,onUpdate:e.updateStationeryDataAsync,onClose:e.clearStationery},null,8,["modelValue","stationery","isView","onUpdate","onClose"])],64)}const xt=oe(St,[["render",Rt],["__scopeId","data-v-f6841402"]]);export{xt as default};
