import{j as E,l as L,u as B,A as y,_ as O,o as u,m as g,n as d,w as r,P as h,r as C,x as F,y as S,a0 as w,z as R,q as v,L as H,bp as Y,Y as x,E as M,S as _,B as K,a5 as z,a6 as U,D as I,ae as W,af as q,I as j,aB as J,N as Q,cN as X,aj as N,cO as D,ap as P,ac as Z,ad as ee,bH as te,b6 as ne,bG as T,a9 as ae,a8 as ie,a1 as oe,bx as se}from"./index-9d6d511f.js";const re=E({name:"KendoCompanyNumberInputComponent",props:{id:String,isRequired:{type:Boolean,default:!0},value:{type:String,default:""},name:{type:String,default:""},label:{type:String,default:""},indicatorLabel:{type:String,default:""},placeholder:{type:String,default:"Type"},iconPath:{type:String,default:""},iconPathRight:{type:String,default:""},maxLength:{type:Number,default:100},isCapitalizeFirstLetter:{type:Boolean,default:!1},isEditable:{type:Boolean,default:!0},isOverrideCommonPlaceHolderText:{type:Boolean,default:!1},statusLabelColor:{type:String,default:""},isValueReactive:{type:Boolean,default:!1},isDataLoadedCompletely:{type:Boolean,default:!1}},data(){return{isFieldValidOnFirstLoad:!1,eventBus:L("$eventBusService"),valueInternal:"",isUnmounted:!1,errorMessage:""}},computed:{computedPlaceholder(){return this.$t("common-placeholder-text")?this.isOverrideCommonPlaceHolderText&&this.placeholder?this.placeholder:this.$t("common-placeholder-text"):this.placeholder}},watch:{isDataLoadedCompletely(e,t){return e==t||(this.isFieldValidOnFirstLoad=this.validate(this.valueInternal)==""),e}},setup(){const e=B(),{addComponentValidationValue:t,removeValidationValueByFieldId:n}=e;return{addComponentValidationValue:t,removeValidationValueByFieldId:n}},created(){this.valueInternal=this.value,!this.isValueReactive&&(this.isFieldValidOnFirstLoad=this.validate(this.valueInternal)=="")},mounted(){this.isUnmounted=!1,this.isValueReactive&&this.isDataLoadedCompletely&&(this.isFieldValidOnFirstLoad=this.validate(this.valueInternal)=="")},updated(){this.valueInternal=this.value,this.isValueReactive&&this.isDataLoadedCompletely&&(this.isFieldValidOnFirstLoad=this.validate(this.valueInternal)=="")},unmounted(){this.id&&(this.removeValidationValueByFieldId(this.id),this.isUnmounted=!0)},methods:{onInput(e){if(!this.isEditable){this.$emit("onAttemptEdit");return}this.isFieldValidOnFirstLoad=!1,this.valueInternal=e.target.value},capitalizeFirstLetter(e){return!e||e.length<1?"":this.isCapitalizeFirstLetter?`${e[0].toUpperCase()}${e.substring(1)}`:e},validate(e){if(this.errorMessage="",this.isUnmounted)return"";if(this.isValueReactive&&!this.isDataLoadedCompletely)return this.addIdKeyAndErrorValue(""),"";if(this.isFieldValidOnFirstLoad)return this.addIdKeyAndErrorValue(""),"";if(this.isValueReactive&&!e&&this.valueInternal&&(e=this.valueInternal),!this.isRequired)return this.addIdKeyAndErrorValue(""),"";if(!e){const t=`Please enter a valid ${this.label}`;return this.addIdKeyAndErrorValue(t),this.errorMessage=t,t}return this.addIdKeyAndErrorValue(""),""},internalChange(e){this.isEditable&&(this.isFieldValidOnFirstLoad=!1,this.valueInternal=e.target.value,this.$emit("onValueChange",this.valueInternal),this.eventBus.emit(y.formFieldChangedEvent),this.eventBus.emit(y.formFieldPageLevelChangedEvent))},addIdKeyAndErrorValue(e){if(!this.id){console.log("Component id is a must. Your progress bar value will be erratic.");return}const t=this.id;let n={};n[t]=e,this.addComponentValidationValue(t,n)}}});const le=e=>(z("data-v-4de865d4"),e=e(),U(),e),de={class:"position-relative"},me={class:"d-flex align-items-center"},ue={key:0,class:"fineprint ms-1"},ce=le(()=>h("div",{class:"flex-grow-1"},null,-1)),pe={key:0},he=["title"],ye={key:1,class:"status-label",style:{background:"transparent"}},fe=["src"],Ce=["src"];function ge(e,t,n,a,o,m){const l=H,i=Y,c=x,p=M,b=_,f=K;return u(),g("div",de,[d(f,{name:e.name,id:e.id,component:"myTemplate",validator:e.validate},{myTemplate:r(({props:s})=>[d(b,{orientation:"vertical",style:{gap:"6px"}},{default:r(()=>[h("div",me,[d(l,{"editor-id":s.id,class:"control-label align-self-end w-50 mt-5px"},{default:r(()=>[C(F(e.label)+" ",1),e.isRequired?S("",!0):(u(),g("span",ue," (Optional) "))]),_:2},1032,["editor-id"]),ce,e.indicatorLabel?(u(),g("div",{key:0,class:w(e.statusLabelColor==="Green"?"status-label-authorised":"status-label-non-authorised")},[d(l,{class:"paragraph-s-figtree-medium"},{default:r(()=>[e.indicatorLabel?(u(),g("span",pe,[d(i,{class:w(e.statusLabelColor==="Green"?"status-label-authorised":"status-label-non-authorised"),textClass:"is-truncated"},{default:r(()=>[h("span",{title:e.indicatorLabel},F(e.indicatorLabel),9,he)]),_:1},8,["class"])])):S("",!0)]),_:1})],2)):(u(),g("div",ye,[d(l,{class:"paragraph-s-figtree-medium"},{default:r(()=>[C(" ")]),_:1})]))]),d(c,R({class:"input-with-icon",style:{"border-radius":"8px"}},s,{id:s.id,name:s.name,placeholder:e.computedPlaceholder,valid:!(s.touched&&e.errorMessage),value:e.capitalizeFirstLetter(e.valueInternal),onInput:e.onInput,onChange:e.internalChange,maxLength:e.maxLength.toString(),inputPrefix:e.iconPath?"prefix":"",inputSuffix:e.iconPathRight?"suffix":""}),{prefix:r(()=>[h("img",{class:"mx-1",src:e.iconPath,style:{height:"20px"},alt:"icon"},null,8,fe)]),suffix:r(()=>[h("img",{class:"mx-1",src:e.iconPathRight,style:{height:"20px"},alt:"icon"},null,8,Ce)]),_:2},1040,["id","name","placeholder","valid","value","onInput","onChange","maxLength","inputPrefix","inputSuffix"]),s.touched&&e.errorMessage?(u(),v(p,{key:0,class:"error"},{default:r(()=>[C(F(e.errorMessage),1)]),_:1})):S("",!0)]),_:2},1024)]),_:1},8,["name","id","validator"])])}const Se=O(re,[["render",ge],["__scopeId","data-v-4de865d4"]]),ve=E({props:{id:String,name:{type:String,default:""},label:{type:String,default:"Company"},value:{type:String,default:""},placeholder:{type:String,default:"Type..."},isRequired:{type:Boolean,default:!0},isSoleTrader:{type:Boolean,default:!1},isShowBottomResults:{type:Boolean,default:!0},isEditable:{type:Boolean,default:!0},excludedFirm:{type:Object,default:void 0},isValueReactive:{type:Boolean,default:!1},isDataLoadedCompletely:{type:Boolean,default:!1}},data(){return{isFieldValidOnFirstLoad:!1,isLoadingCompanyHouseDetails:!1,companiesHouseService:I.resolve(W.name),fcaService:I.resolve(q.name),firms:[],debounceTimer:null,debounceTimerInMs:500,helperService:I.resolve(j.name),postCodeKeyword:"(Postcode: ",regionCodeKeyword:"(Region: ",isOpened:!1,eventBusNotFoundCompany:L("$eventBusService"),eventBus:L("$eventBusService"),formatFirms:[],keywordFirmSearch:"",currentlySelectedCompany:void 0,inputClass:"default-firm",controlContainerId:"company-autocomplete-container",isCompanyHasMatch:!1,searchIconWidth:20,controlContainerLeftPadding:12,isUnmounted:!1,errorMessage:""}},watch:{isDataLoadedCompletely(e,t){return e==t||(this.isFieldValidOnFirstLoad=this.validate(this.value)==""),e}},created(){this.isValueReactive||(this.isFieldValidOnFirstLoad=this.validate(this.value)=="")},mounted(){this.isUnmounted=!1,this.isValueReactive&&this.isDataLoadedCompletely&&(this.isFieldValidOnFirstLoad=this.validate(this.value)=="")},updated(){this.isFieldValidOnFirstLoad=this.validate(this.value)==""},unmounted(){this.id&&this.removeValidationValueByFieldId(this.id)},setup(){const e=B(),{addComponentValidationValue:t,removeValidationValueByFieldId:n}=e;return{removeValidationValueByFieldId:n,addComponentValidationValue:t}},methods:{async onValueChangeAsync(e){if(!this.isEditable){this.$emit("onAttemptEdit");return}if(this.debounceTimer&&clearTimeout(this.debounceTimer),!e.value&&(e==null?void 0:e.type)==="change")return;this.keywordFirmSearch=e.value??"",this.isFieldValidOnFirstLoad=!1,this.$emit("onInput",this.keywordFirmSearch),this.eventBus.emit(y.formFieldChangedEvent),this.eventBus.emit(y.formFieldPageLevelChangedEvent);let t="";this.debounceTimer=setTimeout(async()=>{if(!this.keywordFirmSearch||this.keywordFirmSearch.length<3){this.resetAutoCompleteEnum();return}if(this.formatFirms=[],t=this.keywordFirmSearch,this.firms=await this.fcaService.searchFirmsByFirmNameKeywordAsync(encodeURIComponent(t)),!(this.firms&&this.firms.length>0)){this.resetAutoCompleteEnum();return}this.helperService.isStringNumber(t.trim())?this.firms=this.firms.filter(n=>{var a;return(a=n.companyNumber)==null?void 0:a.toLowerCase().startsWith(t.toLowerCase())}):this.firms=this.firms.filter(n=>{var a;return(a=n.companyName)==null?void 0:a.toLowerCase().startsWith(t.toLowerCase())}),this.firms.forEach(n=>{const a=n.companyName.trim();n.postcode?this.formatFirms.push(`${a} ${this.postCodeKeyword}${n.postcode})`):n.region?this.formatFirms.push(`${a} ${this.regionCodeKeyword}${n.region})`):this.formatFirms.push(`${a}`)}),this.formatFirms=[...new Set(this.formatFirms)],this.isCompanyHasMatch=!0,this.formatFirms.length<=0&&this.resetAutoCompleteEnum()},this.debounceTimerInMs),await this.helperService.delayAsync(500),!(this.formatFirms.length<=0)&&(this.formatFirms=[...new Set(this.formatFirms)])},onOpen(e){this.isEditable&&(setTimeout(()=>{this.alignAutocompleteResultDropdown(),this.setAutoCompleteListTopMargin()},100),this.isOpened=!0)},onClose(e){var a;let t=e.target.value;t&&this.displayNoCompanyPopupIfHasNoCompany(),this.isOpened=!1,e.event.type!=="click"||!this.extractSelectedFirm(t)&&((a=e.event.currentTarget)==null||a.className)},async onSelectAsync(e){var t;try{this.isLoadingCompanyHouseDetails=!0,this.currentlySelectedCompany=void 0;let n=e.target.value,a=this.extractSelectedFirm(n);if(!a)return;if(this.excludedFirm&&a.firmReferenceNo===this.excludedFirm.firmReferenceNumber){this.$emit("onFirmSelectionNotAllowed");const A={companyName:"",address:"",tradingAddress:"",postcode:"",companyNumber:"",firmReferenceNo:"",status:"",companyHouseStatus:"",type:"",isAuthorized:!1,isConfirmedFirmDetails:!1,isVariedFirmPermissions:!1,isSelected:!1,region:"",isSoleTrader:!1,appointedRepresentatives:[],contactNumber:void 0,website:void 0,sicCode:"",countryCode:""};this.$emit("onValueChange",A);return}let o=this.cleanCompanyName(n);const m=await this.companiesHouseService.searchCompaniesAsync(o);if(!m||m.length<1)return;let l=m.find(A=>this.compareIfMatched(A,o));if(!l)return;a.companyNumber=l.companyNumber,a.address=l.address,a.companyHouseStatus=l.status,this.currentlySelectedCompany=a;const i=this.fcaService.extractTradingAddressDetailsAsync(this.currentlySelectedCompany.firmReferenceNo),c=this.companiesHouseService.getCompanyProfileAsync(a.companyNumber),[p,b]=await Promise.all([i,c]),f=p;this.currentlySelectedCompany.tradingAddress=f.address,this.currentlySelectedCompany.website=f.website,this.currentlySelectedCompany.contactNumber=f.phoneNumber;const s=b;s!=null&&s.sic_codes&&s.sic_codes.length>0&&(this.currentlySelectedCompany.sicCode=s.sic_codes[0]),(t=s==null?void 0:s.registered_office_address)!=null&&t.country&&(this.currentlySelectedCompany.countryCode=await this.helperService.getCountryCodeAsync(s.registered_office_address.country)),this.adjustUiSelectedCompany(),this.$emit("onValueChange",this.currentlySelectedCompany)}finally{this.isLoadingCompanyHouseDetails=!1}},adjustUiSelectedCompany(){if(!this.currentlySelectedCompany)return;const e=document.querySelector(".k-autocomplete.k-input .k-input-inner");e&&e.blur(),this.currentlySelectedCompany.isAuthorized=this.currentlySelectedCompany.status===y.authorised,this.currentlySelectedCompany.isSelected=!0,this.controlContainerId="company-autocomplete-container-non-authorised",this.inputClass="non-authorised-firm",this.setClearIconToCheckIfAuthorised(this.currentlySelectedCompany.isAuthorized)},extractSelectedFirm(e){var l;let t="",n="",a="";if(e.includes(this.postCodeKeyword)){let i=e.indexOf(this.postCodeKeyword);t=e.substring(0,i-1).trim();let c=e.indexOf(")"),p=this.postCodeKeyword.length;n=e.substring(i+p,c).trim()}else if(e.includes(this.regionCodeKeyword)){let i=e.indexOf(this.regionCodeKeyword);t=e.substring(0,i-1).trim();let c=e.indexOf(")"),p=this.regionCodeKeyword.length;a=e.substring(i+p,c).trim()}else t=e.toString();let o=(l=this.firms)==null?void 0:l.filter(i=>i.companyName.trim()===t),m=null;return n?m=o.find(i=>i.postcode===n):a?m=o.find(i=>i.region===a):m=o[0],m},alignAutocompleteResultDropdown(){let e=document.querySelector(".k-list-container.k-popup.k-child-animation-container");if(!(e instanceof HTMLElement))return;const t=e.offsetWidth,n=this.searchIconWidth+this.controlContainerLeftPadding;e.style.position="relative",e.style.left=`-${n}px`,e.style.width=`${t+n}px`},setAutoCompleteListTopMargin(){let e=document.querySelector(".k-animation-container.k-animation-container-relative");e instanceof HTMLElement&&(e.style.marginTop="25px")},resetAutoCompleteEnum(){this.isCompanyHasMatch=!1,this.formatFirms=[this.keywordFirmSearch]},displayNoCompanyPopupIfHasNoCompany(){this.isCompanyHasMatch||this.eventBusNotFoundCompany.emit(y.firmNotFoundEvent,{msg:`Company '${this.keywordFirmSearch}' does not exists!`,company:this.keywordFirmSearch})},validate(e){if(this.errorMessage="",this.isUnmounted)return"";if(this.isValueReactive&&!this.isDataLoadedCompletely)return this.addIdKeyAndErrorValue(""),"";if(this.isFieldValidOnFirstLoad)return this.addIdKeyAndErrorValue(""),"";if(this.isValueReactive&&!e&&this.value&&(e=this.value),!e){this.currentlySelectedCompany=void 0;const t=`Please enter a valid ${this.label}`;return this.addIdKeyAndErrorValue(t),this.errorMessage=t,t}return this.addIdKeyAndErrorValue(""),""},onMouseOver(){if(!this.currentlySelectedCompany){this.inputClass="default-firm",this.controlContainerId="company-autocomplete-container";return}},setClearIconToCheckIfAuthorised(e){let t=document.querySelector("span.k-clear-value");if(!t||(this.setClearActionListener(t),!e))return;let n=t.firstChild;t.removeChild(n);let a=document.createElement("span");a&&(a.classList.add("k-icon"),a.classList.add("k-i-check"),t.appendChild(a))},setClearActionListener(e){const t=()=>{this.controlContainerId="company-autocomplete-container",this.$emit("onClear")};e.removeEventListener("click",t),e.addEventListener("click",t)},cleanCompanyName(e){let t=e;if(t.includes("&")&&(t=t.replaceAll("&","and")),t.includes(this.postCodeKeyword)){let n=t.indexOf(this.postCodeKeyword);t=t.substring(0,n-1).trim()}else if(t.includes(this.regionCodeKeyword)){let n=t.indexOf(this.regionCodeKeyword);t=t.substring(0,n-1).trim()}else t=t.toString();return t=t.endsWith(".")?t.substring(0,t.length-1):t,t},compareIfMatched(e,t){let n=e.companyName;n.includes("&")&&(n=n.replaceAll("&","and"));const a=this.removeLimitedOrLtdIfAny(t);if(n.toLowerCase().startsWith(a.toLowerCase()))return e},addIdKeyAndErrorValue(e){if(!this.id)return;const t=this.id;let n={};n[t]=e,this.addComponentValidationValue(t,n)},removeLimitedOrLtdIfAny(e){const t=new RegExp("limited","i"),n=new RegExp("ltd","ig");return n.test(e)?e.replace(n,""):t.test(e)?e.replace(t,""):e}}});const G=e=>(z("data-v-062b02a1"),e=e(),U(),e),Ie={class:"position-relative"},be={key:0,class:"fineprint ms-1"},Fe=G(()=>h("span",{class:"k-icon k-i-information"},null,-1)),Ae={class:"caption-frn"},Le=G(()=>h("span",{class:"mx-2 caption-figtree-medium"},"|",-1)),Ne={class:"caption-figtree-semi-bold"};function we(e,t,n,a,o,m){const l=H,i=_,c=Q,p=X,b=M,f=K;return u(),g("div",Ie,[d(f,{name:e.name,id:e.id,validator:e.validate,component:"myTemplate"},{myTemplate:r(({props:s})=>[d(i,{orientation:"vertical",style:{gap:"6px"}},{default:r(()=>[d(i,{orientation:"horizontal",align:{horizontal:"start"}},{default:r(()=>[e.label?(u(),v(l,{key:0,"editor-id":s.id,class:"control-label paragraph-s-figtree-medium flex-grow-1 mt-7px"},{default:r(()=>[C(F(e.label)+" ",1),e.isRequired?S("",!0):(u(),g("span",be," (Optional) "))]),_:2},1032,["editor-id"])):S("",!0)]),_:2},1024),d(i,{orientation:"horizontal",id:e.controlContainerId,class:w(["control-container",e.inputClass]),style:J(`padding-left: ${e.controlContainerLeftPadding}px; ${s.touched&&e.errorMessage?"border-color: #f31700":""}`),align:{horizontal:"start",vertical:"middle"}},{default:r(()=>[d(c,{symbol:"search-icon",size:e.searchIconWidth.toString(),class:"magnifier"},null,8,["size"]),d(p,R(s,{id:"fca-autocomplete",fillMode:null,class:"control",placeholder:e.placeholder,opened:e.isOpened,"data-items":e.formatFirms,value:e.value,onChange:e.onValueChangeAsync,onOpen:e.onOpen,onClose:e.onClose,onSelect:e.onSelectAsync,onMouseover:e.onMouseOver}),null,16,["placeholder","opened","data-items","value","onChange","onOpen","onClose","onSelect","onMouseover"])]),_:2},1032,["id","style","class"]),e.isOpened?(u(),v(l,{key:0,class:"mt-2 paragraph-s-figtree-regular"},{default:r(()=>[Fe,C(" If your firm doesn't appear in the dropdown list, please enter it manually. ")]),_:1})):S("",!0),e.isLoadingCompanyHouseDetails?(u(),v(i,{key:1,class:"mt-2 caption-figtree-medium"},{default:r(()=>[C(" Searching... ")]),_:1})):e.isShowBottomResults&&e.currentlySelectedCompany?(u(),v(i,{key:2,class:"mt-2",orientation:"horizontal",align:{horizontal:"start"}},{default:r(()=>[d(l,{class:"caption-figtree-medium"},{default:r(()=>[C(" Firm Reference Number: "),h("span",Ae,F(e.currentlySelectedCompany.firmReferenceNo),1)]),_:1}),Le,d(l,{class:"caption-figtree-medium"},{default:r(()=>[C(" Company Number: "),h("span",Ne,F(e.currentlySelectedCompany.companyNumber),1)]),_:1})]),_:1})):S("",!0),s.touched&&e.errorMessage?(u(),v(b,{key:3,class:"error"},{default:r(()=>[C(F(e.errorMessage),1)]),_:1})):S("",!0)]),_:2},1024)]),_:1},8,["name","id","validator"])])}const Ee=O(ve,[["render",we],["__scopeId","data-v-062b02a1"]]),Oe=E({name:"KendoFirmFinderComponent",props:{id:String,name:{type:String,default:""},companyNameLabel:{type:String,default:"Company Name"},companyNamePlaceholder:{type:String,default:"Type"},companyNumberLabel:{type:String,default:"Company Number"},firmReferenceNumberLabel:{type:String,default:"Firm Reference Number"},companyName:{type:String,default:""},companyNumber:{type:String,default:""},firmReferenceNumber:{type:String,default:""},isInitializing:{type:Boolean,default:!0},company:{type:Object,default:new N},isCompanyDetailsEditAllowed:{type:Boolean,default:!1},mode:{type:Number,default:D.FromFca},excludedFirm:{type:Object,default:void 0},isEnableSearch:{type:Boolean,default:!0},useDefaultSchedMeetingModal:{type:Boolean,default:!0},onboardingType:{type:String,default:P.Firm.toString()},maxLengthBeforeTruncate:{type:Number,default:23}},data(){return{eventBus:L("$eventBusService"),companySearchText:"",companyInternal:new N,userFirmFcaPermissions:[],isInitializingInternal:!0,isAddFirmMarginTop:!0,companiesHouseService:I.resolve(W.name),appService:I.resolve(Z.name),fcaService:I.resolve(q.name),helperService:I.resolve(j.name),fcaDefinedStatuses:[],companyHouseDefinedStatuses:[],calendlyService:I.resolve(ee.name),kendoDialogInstance:null,kendoPromptInstance:null,kendoCalendarFlexibleDialogInstance:null,eventBusCompanyOrFrnNo:L("$eventBusService"),colorCodingCompanyHouse:"",colorCodingFCA:"",companyStatusText:"",fcaStatusText:""}},computed:{CompanySearchMode(){return D},computedPlaceholder(){return this.$t("common-placeholder-text")?this.$t("common-placeholder-text"):this.companyNamePlaceholder}},created(){if(this.setBindingAsync(),this.getFcaDefinedStatusesFromCacheThenSet(),this.getCompanyHouseDefinedStatusesFromCacheThenSet(),this.onboardingType!==P.Firm.toString())return;const e=this.appService.getCachedCustomer()??new te;e!=null&&e.currentFcaPermissions&&(this.userFirmFcaPermissions=e.currentFcaPermissions)},async mounted(){var e,t,n,a;if(!((e=this.companyInternal)!=null&&e.fcaStatus)&&((t=this.companyInternal)!=null&&t.firmReferenceNumber)){const o=await this.fcaService.getFcaFirmDetailByRefNoAsync(this.companyInternal.firmReferenceNumber);this.companyInternal.fcaStatus=(o==null?void 0:o.status)??""}if(!((n=this.companyInternal)!=null&&n.companyHouseStatus)&&((a=this.companyInternal)!=null&&a.companyNumber)){const o=await this.companiesHouseService.getCompanyProfileAsync(this.companyInternal.companyNumber);this.companyInternal.companyHouseStatus=(o==null?void 0:o.company_status)??""}this.assignFCAStatusAndColor(),this.assignCompanyHouseStatusAndColor()},async updated(){await this.setBindingAsync()},methods:{async setBindingAsync(){var e,t;!ne(this.company)&&!((e=this.companyInternal)!=null&&e.companyNumber||(t=this.companyInternal)!=null&&t.firmReferenceNumber)&&(this.companyInternal=this.company),this.isInitializingInternal=this.isInitializing},getFCAStatus(){return this.fcaDefinedStatuses.find(t=>{var n,a;return((n=t.actualStatus)==null?void 0:n.toLowerCase())===((a=this.companyInternal.fcaStatus)==null?void 0:a.toLowerCase())})},getCompanyHouseStatus(){return this.companyHouseDefinedStatuses.find(t=>{var n,a;return((n=t.status)==null?void 0:n.toLocaleLowerCase)==((a=this.companyInternal.companyHouseStatus)==null?void 0:a.toLocaleLowerCase)})},async onCompanyValueChanged(e){var a;let t=new N;if(t.firmName=e.companyName,t.companyNumber=e.companyNumber,t.firmReferenceNumber=e.firmReferenceNo,t.address=e.address,t.tradingAddress=e.tradingAddress,t.contactNumber=e.contactNumber,t.website=e.website,t.fcaStatus=e.status,t.companyHouseStatus=e.companyHouseStatus,t.sicCode=e.sicCode,t.countryCode=e.countryCode,this.companyInternal=t,this.isAddFirmMarginTop=!0,!((a=this.companyInternal)!=null&&a.fcaStatus))return;const n=this.assignFCAStatusAndColor();n||this.$emit("onCompanyNotAuthorised",this.companyInternal),this.assignCompanyHouseStatusAndColor(),this.$emit("onCompanyDetailUpdated",this.companyInternal),n&&await this.checkIfFirmHasSamePermissionWithUserFirmAsync(this.companyInternal.firmReferenceNumber)},assignFCAStatusAndColor(){let e=!1;const t=this.getFCAStatus();return t?(e=t&&t.isAuthorised,this.fcaStatusText=t.actualStatus,this.colorCodingFCA=t==null?void 0:t.colorCoding):(this.fcaStatusText=this.companyInternal.fcaStatus,this.colorCodingFCA="Red"),e},assignCompanyHouseStatusAndColor(){const e=this.getCompanyHouseStatus();e?(this.companyStatusText=e.statusDisplayText,this.colorCodingCompanyHouse=e==null?void 0:e.colorCoding):(this.companyStatusText=this.companyInternal.companyHouseStatus,this.colorCodingCompanyHouse="Red")},onClearCompany(){this.companyInternal=new N,this.$emit("onCompanyDetailUpdated",this.companyInternal)},onCompanyNameInput(e){this.companyInternal.firmName=e},onCompanyNumberInput(e){var t;e&&this.isCompanyDetailsEditAllowed&&((t=this.companyInternal)==null?void 0:t.companyNumber)!==e&&(this.companyInternal.companyNumber=e,this.$emit("onCompanyDetailUpdated",this.companyInternal))},onFirmReferenceNumberInput(e){e&&this.isCompanyDetailsEditAllowed&&(this.companyInternal.firmReferenceNumber=e,this.$emit("onCompanyDetailUpdated",this.companyInternal))},onAttemptEdit(){if(this.useDefaultSchedMeetingModal){this.kendoPromptInstance?this.kendoPromptInstance.setActionDialogMessage("Confirm"):(this.kendoPromptInstance=this.$refs.kendoActionDialogCompanyNumber,this.kendoPromptInstance.setActionDialogMessage("Confirm"));return}this.eventBus.emit(y.requestCompanyDetailsUpdateEvent,{payload:""})},onFirmSelectionFailed(){this.eventBus.emit(y.firmSelectionErrorEvent,{payload:""})},async getFcaDefinedStatusesFromCacheThenSet(){const e=localStorage.getItem(y.fcaDefinedStatusesKey);if(e){const t=JSON.parse(e);t&&(this.fcaDefinedStatuses=t)}},async getCompanyHouseDefinedStatusesFromCacheThenSet(){const e=localStorage.getItem(y.companyHouseDefinedStatusesKey);if(e){const t=JSON.parse(e);t&&(this.companyHouseDefinedStatuses=t)}},async checkIfFirmHasSamePermissionWithUserFirmAsync(e){const t=await this.fcaService.getCurrentFirmFcaPermissionsAsync(e);if(!t||t.length<1){this.$emit("onPermissionNotSame",[]);return}const n=this.userFirmFcaPermissions.filter(i=>i.state===T.Added),a=t.filter(i=>i.state===T.Added),o=n.map(i=>i.subPermissionName),m=a.map(i=>i.subPermissionName);if(!o.every(i=>m.includes(i))){const i=o.filter(c=>!m.includes(c));this.$emit("onPermissionNotSame",i)}},async scheduleAMeetingAsync(){var a,o,m;(a=this.kendoPromptInstance)==null||a.closeActionDialog();let t=(await this.calendlyService.getSchedulingLinkAsync()).filter(l=>l.active);if(!t){(o=this.kendoDialogInstance)==null||o.setDialogMessage("There is no active event.","No event found");return}if(t.length>1){(m=this.kendoCalendarFlexibleDialogInstance)==null||m.showMessageAndContent("","Select Event Type");return}let n=t[0];window.open(n.scheduling_url)},capitalize1stLetterOfEveryWord(e){return e?this.helperService.capitalizeFirstLetterOfWord(e):""}}}),_e=h("div",{class:"paragraph-m-figtree-regular"},[h("p",null,"If you wish to change this, please schedule a meeting below.")],-1);function Ve(e,t,n,a,o,m){const l=ae,i=ie,c=oe,p=Ee,b=Se,f=se,s=_;return u(),g("div",null,[d(s,{orientation:"horizontal",style:J([{gap:"15px"},{"margin-top":e.isAddFirmMarginTop?"8px":"0px"}]),align:{horizontal:"stretch",vertical:"top"}},{default:r(()=>{var A,V,$,k;return[d(l,{ref:"kendoDialog"},null,512),d(i,{ref:"kendoActionDialogCompanyNumber",primaryActionButtonLabel:"Schedule a meeting",primaryActionButtonIcon:"/calendar.svg",onOnPrimaryActionClick:e.scheduleAMeetingAsync},{default:r(()=>[_e]),_:1},8,["onOnPrimaryActionClick"]),e.mode===e.CompanySearchMode.FromCompanyHouse?(u(),v(c,{key:0,id:e.id+".companyInternal.companyName",name:e.id+".companyInternal.companyName",label:e.companyNameLabel,placeholder:e.computedPlaceholder,value:(A=e.companyInternal)==null?void 0:A.firmName,isShowBottomResults:!1,isDataLoadedCompletely:!e.isInitializingInternal,isValueReactive:!0,isEditable:e.isEnableSearch,onOnAttemptEdit:e.onAttemptEdit,onOnInput:e.onCompanyNameInput,onOnClear:e.onClearCompany,onOnValueChange:e.onCompanyValueChanged,isShowHighLightColor:!1},null,8,["id","name","label","placeholder","value","isDataLoadedCompletely","isEditable","onOnAttemptEdit","onOnInput","onOnClear","onOnValueChange"])):(u(),v(p,{key:1,id:e.id+".companyInternal.companyName",name:e.id+".companyInternal.companyName",label:e.companyNameLabel,placeholder:e.computedPlaceholder,value:(V=e.companyInternal)==null?void 0:V.firmName,isShowBottomResults:!1,isDataLoadedCompletely:!e.isInitializingInternal,isValueReactive:!0,isEditable:e.isEnableSearch,excludedFirm:e.excludedFirm,onOnFirmSelectionNotAllowed:e.onFirmSelectionFailed,onOnAttemptEdit:e.onAttemptEdit,onOnInput:e.onCompanyNameInput,onOnClear:e.onClearCompany,onOnValueChange:e.onCompanyValueChanged},null,8,["id","name","label","placeholder","value","isDataLoadedCompletely","isEditable","excludedFirm","onOnFirmSelectionNotAllowed","onOnAttemptEdit","onOnInput","onOnClear","onOnValueChange"])),d(b,{name:e.id+".companyInternal.companyNumber",id:e.id+".companyInternal.companyNumber",label:e.companyNumberLabel,placeholder:e.$t("common-companynumber-text"),isEditable:e.isCompanyDetailsEditAllowed,onOnValueChange:e.onCompanyNumberInput,indicatorLabel:e.companyStatusText,onOnAttemptEdit:e.onAttemptEdit,value:($=e.companyInternal)==null?void 0:$.companyNumber,isValueReactive:!0,isDataLoadedCompletely:!e.isInitializingInternal,isOverrideCommonPlaceHolderText:!0,statusLabelColor:e.colorCodingCompanyHouse},null,8,["name","id","label","placeholder","isEditable","onOnValueChange","indicatorLabel","onOnAttemptEdit","value","isDataLoadedCompletely","statusLabelColor"]),d(f,{name:e.id+".companyInternal.referenceNumber",id:e.id+".companyInternal.referenceNumber",label:e.firmReferenceNumberLabel,indicatorLabel:e.fcaStatusText,placeholder:e.$t("common-firmref-text"),isEditable:e.isCompanyDetailsEditAllowed,onOnValueChange:e.onFirmReferenceNumberInput,onOnAttemptEdit:e.onAttemptEdit,value:(k=e.companyInternal)==null?void 0:k.firmReferenceNumber,maxLength:7,isValueReactive:!0,isDataLoadedCompletely:!e.isInitializingInternal,isOverrideCommonPlaceHolderText:!0,statusLabelColor:e.colorCodingFCA,maxLengthBeforeTruncate:e.maxLengthBeforeTruncate},null,8,["name","id","label","indicatorLabel","placeholder","isEditable","onOnValueChange","onOnAttemptEdit","value","isDataLoadedCompletely","statusLabelColor","maxLengthBeforeTruncate"])]}),_:1},8,["style"])])}const ke=O(Oe,[["render",Ve]]);export{ke as default};
