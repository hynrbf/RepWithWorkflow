/*
 *             Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x8d8a=['some','addComment','arrowView','size','listenTo','CommentsUI','TrackChangesEditing','Discard\x20all\x20suggestions','getDescriptions','switchbutton','mainView','plugins','_unbindEditors','getMarkerNames','editing','getByInnerView','stopListening','push','createAnnotation','isInContent','Discard\x20all\x20selected\x20suggestions','getRanges','SuggestionThreadView','_handleSuggestionControllerDelayed','hasSuggestion','isDirty','suggestion-','suggestionLoaded','bind','_handleControllerBuffer','destroy','suggestionChanged','buttonView','EditorAnnotations','length','config','_suggestionToController','comments.editorConfig','delete','Track\x20changes','_annotationViews','activeAnnotations','define','lowest','focus','view','_updateController','actionView','type','_initializeController','commands','innerView','value','add','comments','head','map','toMany','separator','execute','acceptSelectedSuggestions','change:previous','TrackChangesUI','isOn','descriptionParts','addSourceCollector','createCommentThreadController','has','editor','discardButton','discardAllSuggestions','discardSelectedSuggestions','from','comments.maxThreadTotalWeight','unbind','commentThread','Accept\x20all\x20selected\x20suggestions','source','Annotations','get','CommentsRepository','trackChanges.disableComments','trackChanges','getJoined','_destroyController','_refreshActiveMarkers','keys','filter','locale','_descriptionFactory','componentFactory','refreshSelectedViews','registerAnnotation','getAllAdjacentSuggestions','model','button','getMarkers','commandName','_viewToController','activeMarkers','set','previous','isEnabled','_createUIButton'];(function(_0x37bf01,_0x8d8ad5){const _0x4ee02d=function(_0x263487){while(--_0x263487){_0x37bf01['push'](_0x37bf01['shift']());}};_0x4ee02d(++_0x8d8ad5);}(_0x8d8a,0x14e));const _0x4ee0=function(_0x37bf01,_0x8d8ad5){_0x37bf01=_0x37bf01-0x0;let _0x4ee02d=_0x8d8a[_0x37bf01];return _0x4ee02d;};import{Plugin as _0xbaaed1}from'ckeditor5/src/core';import{Collection as _0x3cf74f}from'ckeditor5/src/utils';import{Model as _0x326b34,SplitButtonView as _0x525d9f,createDropdown as _0x5373c7,addListToDropdown as _0x329a8a}from'ckeditor5/src/ui';import{Users as _0xf90181,getDateTimeFormatter as _0x5e25f7,getAllMarkersDomElementsSorted as _0x3ccda7}from'ckeditor5-collaboration/src/collaboration-core';import _0x5afaf1 from'./trackchangesediting';import _0x5e206b from'./ui/suggestioncontroller';import _0x55a6e2 from'./ui/view/suggestionthreadview';import{getTranslation as _0x5a85b5}from'./utils/common-translations';import _0x2365d0 from'../theme/icons/track-changes.svg';export default class d extends _0xbaaed1{static get['requires'](){return[_0x5afaf1,_0xf90181,_0x4ee0('0x3a'),_0x4ee0('0x38'),_0x4ee0('0xb')];}static get['pluginName'](){return _0x4ee0('0x28');}constructor(_0x460511){super(_0x460511),this[_0x4ee0('0xe')]=new Map(),this[_0x4ee0('0x4c')]=new Map(),this[_0x4ee0('0x12')]=new Map(),this[_0x4ee0('0x7')]=new Map();const _0x188681=this[_0x4ee0('0x2e')][_0x4ee0('0xd')];_0x188681[_0x4ee0('0x14')]('trackChanges.SuggestionThreadView',_0x55a6e2),_0x188681[_0x4ee0('0x14')](_0x4ee0('0x3b'),!0x1),this['_disableComments']=_0x188681[_0x4ee0('0x39')](_0x4ee0('0x3b'));}['_handleSuggestionControllerDelayed'](_0x559e4c,_0xe3dab0){0x0===this[_0x4ee0('0x7')][_0x4ee0('0x55')]&&setTimeout(()=>{for(const [_0x6713fb,_0x228290]of this['_handleControllerBuffer']){const _0x20b590=this['_suggestionToController'][_0x4ee0('0x2d')](_0x6713fb);_0x20b590||_0x228290?_0x20b590&&_0x228290&&this['_destroyController'](_0x6713fb):this[_0x4ee0('0x1b')](_0x6713fb);}this[_0x4ee0('0x2e')][_0x4ee0('0x5d')][_0x4ee0('0x39')](_0x4ee0('0xb'))[_0x4ee0('0x45')](),this[_0x4ee0('0x3f')](),this[_0x4ee0('0x7')]['clear']();},0xa),this[_0x4ee0('0x7')]['set'](_0x559e4c,_0xe3dab0);}['init'](){const _0x20c4f8=this[_0x4ee0('0x2e')],_0x48f899=_0x20c4f8[_0x4ee0('0x5d')]['get'](_0x4ee0('0x58')),_0x5d486f=_0x20c4f8[_0x4ee0('0x5d')][_0x4ee0('0x39')](_0x4ee0('0x38')),_0x257be5=_0x20c4f8['plugins'][_0x4ee0('0x39')](_0x4ee0('0xb')),_0x4d3c42=_0x20c4f8[_0x4ee0('0x5d')][_0x4ee0('0x39')](_0x4ee0('0x3a'));_0x20c4f8['ui'][_0x4ee0('0x44')][_0x4ee0('0x1f')](_0x4ee0('0x3c'),_0x8cce95=>this[_0x4ee0('0x51')](_0x8cce95)),_0x257be5[_0x4ee0('0x2b')](()=>{const _0x1df0f7=[];for(const [_0x1f0008,_0x496d3b]of Array[_0x4ee0('0x32')](this[_0x4ee0('0xe')])){const _0x27ecfc=_0x1f0008['getAllAdjacentSuggestions'](),_0x8f12e6=[];for(const _0x5c30dd of _0x27ecfc){if(!_0x5c30dd[_0x4ee0('0x65')])continue;if(_0x5c30dd['isMultiRange']){_0x8f12e6['push'](..._0x5c30dd[_0x4ee0('0x67')]());continue;}const _0x58a724=_0x5c30dd['getFirstRange']();if(_0x8f12e6['length']>0x0){const _0x5f5ac0=_0x8f12e6[0x0][_0x4ee0('0x3d')](_0x58a724);if(_0x5f5ac0){_0x8f12e6[0x0]=_0x5f5ac0;continue;}}_0x8f12e6[_0x4ee0('0x63')](_0x58a724);}_0x1df0f7[_0x4ee0('0x63')]([_0x496d3b[_0x4ee0('0x17')],_0x8f12e6]);}return _0x1df0f7;}),this[_0x4ee0('0x56')](_0x48f899,_0x4ee0('0x5'),(_0x6586f4,_0x21192e)=>{this[_0x4ee0('0x56')](_0x21192e,_0x4ee0('0x27'),(_0x30a7b0,_0xae2e66,_0x3aacde,_0x510c64)=>{_0x21192e['isInContent']&&(null==_0x3aacde?(this['_updateController'](_0x510c64[_0x4ee0('0x21')]),this[_0x4ee0('0x1')](_0x21192e,!0x1)):(this[_0x4ee0('0x18')](_0x3aacde['head']),this['_handleSuggestionControllerDelayed'](_0x21192e,!0x0)));}),null===_0x21192e[_0x4ee0('0x4f')]?this['_handleSuggestionControllerDelayed'](_0x21192e,!0x1):this[_0x4ee0('0x18')](_0x21192e[_0x4ee0('0x21')]);}),this[_0x4ee0('0x56')](_0x48f899,'suggestionUnloaded',(_0x23a6fc,_0x1fac39,_0xa9d706)=>{this[_0x4ee0('0x62')](_0x1fac39,_0x4ee0('0x27')),this[_0x4ee0('0x7')][_0x4ee0('0x10')](_0x1fac39);const _0x2a5278=_0xa9d706?_0xa9d706[_0x4ee0('0x21')]:_0x1fac39,_0x1e0c21=this[_0x4ee0('0xe')][_0x4ee0('0x39')](_0x2a5278);null!==_0xa9d706&&this[_0x4ee0('0x18')](_0x2a5278),null===_0xa9d706&&_0x1e0c21&&this[_0x4ee0('0x3e')](_0x1fac39);}),this['listenTo'](_0x48f899,_0x4ee0('0x9'),(_0x42c964,_0x1c5c2a)=>{this[_0x4ee0('0x18')](_0x1c5c2a);}),this[_0x4ee0('0x56')](_0x5d486f,'change:activeAnnotations',()=>{this[_0x4ee0('0x3f')]();}),this[_0x4ee0('0x56')](_0x4d3c42,_0x4ee0('0x53'),(_0x470bfe,{threadId:_0x38be82,isFromAdapter:_0x1cc0b5})=>{if(_0x1cc0b5||!_0x48f899[_0x4ee0('0x2')](_0x38be82))return;const _0x3ba74b=_0x48f899['getSuggestion'](_0x38be82);this['_suggestionToController'][_0x4ee0('0x39')](_0x3ba74b)['view'][_0x4ee0('0x16')]();},{'priority':_0x4ee0('0x15')});}[_0x4ee0('0x3f')](){const _0x2851e6=this[_0x4ee0('0x2e')]['plugins'][_0x4ee0('0x39')](_0x4ee0('0x38')),_0x64fa03=this[_0x4ee0('0x2e')][_0x4ee0('0x5d')][_0x4ee0('0x39')](_0x4ee0('0x58')),_0x2a4822=Array['from'](_0x2851e6[_0x4ee0('0x13')],_0xd6dd4=>_0xd6dd4[_0x4ee0('0x1d')])[_0x4ee0('0x41')](_0x2d227e=>this[_0x4ee0('0x4c')][_0x4ee0('0x2d')](_0x2d227e)),_0x1373cf=[];for(const _0x241bee of _0x2a4822){const _0x4730d2=this['_viewToController']['get'](_0x241bee)[_0x4ee0('0x48')][_0x4ee0('0x47')]();_0x1373cf['push'](..._0x4730d2['reduce']((_0x129f2c,_0x32b8fa)=>[..._0x129f2c,..._0x32b8fa[_0x4ee0('0x5f')]()],[]));}_0x64fa03[_0x4ee0('0x4d')]=_0x1373cf;}[_0x4ee0('0x51')](_0x2a3630){const _0x571220=_0x5373c7(_0x2a3630,_0x525d9f),_0x5de9a8=this['editor'][_0x4ee0('0x1c')][_0x4ee0('0x39')]('trackChanges'),_0x6549ff=_0x5a85b5(_0x2a3630,_0x4ee0('0x11'));_0x571220['buttonView']['set']({'tooltip':_0x6549ff,'label':_0x6549ff,'icon':_0x2365d0}),_0x571220[_0x4ee0('0xa')]['bind'](_0x4ee0('0x29'))['to'](_0x5de9a8,_0x4ee0('0x1e')),_0x571220[_0x4ee0('0xa')]['on']('execute',()=>{_0x5de9a8['execute'](),this[_0x4ee0('0x2e')][_0x4ee0('0x60')][_0x4ee0('0x17')]['focus']();});const _0x16085b=new _0x3cf74f(),_0x59a733=[{'type':_0x4ee0('0x5b'),'model':{'withText':!0x0,'label':_0x6549ff,'commandName':'trackChanges'}},{'type':_0x4ee0('0x24')},{'type':_0x4ee0('0x49'),'model':{'withText':!0x0,'label':_0x5a85b5(_0x2a3630,'Accept\x20all\x20suggestions'),'commandName':'acceptAllSuggestions'}},{'type':_0x4ee0('0x49'),'model':{'withText':!0x0,'label':_0x5a85b5(_0x2a3630,_0x4ee0('0x36')),'commandName':_0x4ee0('0x26')}},{'type':'button','model':{'withText':!0x0,'label':_0x5a85b5(_0x2a3630,_0x4ee0('0x59')),'commandName':_0x4ee0('0x30')}},{'type':_0x4ee0('0x49'),'model':{'withText':!0x0,'label':_0x5a85b5(_0x2a3630,_0x4ee0('0x66')),'commandName':_0x4ee0('0x31')}}];for(const _0x28463e of _0x59a733){let _0x368197={'type':_0x4ee0('0x24')};if(_0x28463e[_0x4ee0('0x48')]){const _0x4af64f=new _0x326b34(_0x28463e[_0x4ee0('0x48')]),_0x50ade5=this[_0x4ee0('0x2e')][_0x4ee0('0x1c')][_0x4ee0('0x39')](_0x4af64f['commandName']);_0x4af64f['bind'](_0x4ee0('0x29'),_0x4ee0('0x50'))['to'](_0x50ade5,_0x4ee0('0x1e'),_0x4ee0('0x50')),_0x368197={'type':_0x28463e[_0x4ee0('0x1a')],'model':_0x4af64f};}_0x16085b[_0x4ee0('0x1f')](_0x368197);}_0x329a8a(_0x571220,_0x16085b);const _0x4ebc6e=_0x59a733[_0x4ee0('0x41')](_0x26a363=>null!=_0x26a363[_0x4ee0('0x48')])[_0x4ee0('0x22')](_0x51008a=>this['editor']['commands'][_0x4ee0('0x39')](_0x51008a[_0x4ee0('0x48')][_0x4ee0('0x4b')])),_0x4e7223=_0x571220[_0x4ee0('0xa')];return _0x4e7223[_0x4ee0('0x19')]['unbind'](_0x4ee0('0x50')),_0x4e7223['arrowView'][_0x4ee0('0x34')](_0x4ee0('0x50')),_0x4e7223['actionView']['bind'](_0x4ee0('0x50'))['to'](_0x5de9a8,_0x4ee0('0x50')),_0x4e7223[_0x4ee0('0x54')][_0x4ee0('0x6')](_0x4ee0('0x50'))[_0x4ee0('0x23')](_0x4ebc6e,_0x4ee0('0x50'),(..._0xb93840)=>_0xb93840[_0x4ee0('0x52')](_0xce44ce=>_0xce44ce)),_0x571220['on'](_0x4ee0('0x25'),_0x484897=>{this['editor'][_0x4ee0('0x25')](_0x484897[_0x4ee0('0x37')][_0x4ee0('0x4b')]),this[_0x4ee0('0x2e')][_0x4ee0('0x60')]['view']['focus']();}),_0x571220;}[_0x4ee0('0x1b')](_0x505b18){const _0x34da10=this[_0x4ee0('0x2e')],_0x2c6b29=_0x34da10['config'],_0x5d61ed=_0x34da10[_0x4ee0('0x5d')]['get'](_0x4ee0('0x38')),_0x255c42=_0x34da10['plugins'][_0x4ee0('0x39')]('CommentsRepository'),_0x36a63c=_0x34da10[_0x4ee0('0x5d')][_0x4ee0('0x39')](_0x4ee0('0xb')),_0x4d9b92=_0x34da10[_0x4ee0('0x5d')][_0x4ee0('0x39')](_0xf90181)['me'],_0x2888d4=_0x2c6b29[_0x4ee0('0x39')]('trackChanges')[_0x4ee0('0x0')],{CommentsListView:_0x278154,CommentThreadInputView:_0x430d92}=_0x34da10['plugins'][_0x4ee0('0x39')](_0x4ee0('0x57'));let _0x1cf409,_0x1091f4;this[_0x4ee0('0x12')]['has'](_0x505b18['id'])?(_0x1091f4=this[_0x4ee0('0x12')][_0x4ee0('0x39')](_0x505b18['id']),_0x1cf409=_0x1091f4[_0x4ee0('0x5c')]):(_0x1cf409=new _0x2888d4(_0x34da10[_0x4ee0('0x42')],_0x505b18,_0x4d9b92,{'disableComments':this['_disableComments'],'editorConfig':_0x2c6b29[_0x4ee0('0x39')](_0x4ee0('0xf')),'maxCommentsWhenCollapsed':_0x2c6b29[_0x4ee0('0x39')]('comments.maxCommentsWhenCollapsed'),'maxThreadTotalWeight':_0x2c6b29[_0x4ee0('0x39')](_0x4ee0('0x33')),'maxCommentCharsWhenCollapsed':_0x2c6b29[_0x4ee0('0x39')]('comments.maxCommentCharsWhenCollapsed'),'formatDateTime':_0x5e25f7(_0x2c6b29[_0x4ee0('0x39')](_0x4ee0('0x42'))),'CommentView':_0x2c6b29[_0x4ee0('0x39')](_0x4ee0('0x20'))['CommentView'],'CommentsListView':_0x278154,'CommentThreadInputView':_0x430d92}),_0x1cf409['acceptButton']['on'](_0x4ee0('0x25'),()=>{_0x34da10[_0x4ee0('0x60')][_0x4ee0('0x17')]['focus']();}),_0x1cf409[_0x4ee0('0x2f')]['on']('execute',()=>{_0x34da10[_0x4ee0('0x60')][_0x4ee0('0x17')][_0x4ee0('0x16')]();}),_0x1091f4=_0x5d61ed['createAnnotationView'](this['editor'][_0x4ee0('0x42')],_0x1cf409),_0x1091f4['bind'](_0x4ee0('0x3'))['to'](_0x1cf409,'isDirty'),_0x1091f4[_0x4ee0('0x6')](_0x4ee0('0xc'))['to'](_0x1cf409),_0x1091f4[_0x4ee0('0x6')]('type')['to'](_0x1cf409,_0x4ee0('0x1a'),_0x367f54=>_0x4ee0('0x4')+_0x367f54),this[_0x4ee0('0x12')]['set'](_0x505b18['id'],_0x1091f4));const _0x79c1b8=_0x255c42[_0x4ee0('0x2c')](_0x505b18[_0x4ee0('0x35')],_0x1cf409),_0x72d30b=new _0x5e206b(_0x34da10,_0x505b18,_0x1cf409,_0x79c1b8),_0x22e066=_0x505b18[_0x4ee0('0x47')]()[_0x4ee0('0x41')](_0x39e136=>_0x39e136[_0x4ee0('0x65')]);_0x1cf409[_0x4ee0('0x2a')]=_0x34da10['plugins'][_0x4ee0('0x39')]('TrackChangesEditing')[_0x4ee0('0x43')][_0x4ee0('0x5a')](_0x22e066),this[_0x4ee0('0xe')][_0x4ee0('0x4e')](_0x505b18,_0x72d30b),this[_0x4ee0('0x4c')][_0x4ee0('0x4e')](_0x1cf409,_0x72d30b);const _0x1940e8=_0x5d61ed[_0x4ee0('0x64')]({'view':_0x1091f4,'target':()=>{const _0x296fde=[],_0x38a0dd=_0x505b18[_0x4ee0('0x47')]()['filter'](_0x4e2a8e=>_0x4e2a8e[_0x4ee0('0x65')]);for(const _0x5af694 of _0x38a0dd)_0x296fde[_0x4ee0('0x63')](..._0x5af694[_0x4ee0('0x4a')]());return _0x3ccda7(_0x34da10[_0x4ee0('0x60')],_0x296fde);},'type':()=>_0x4ee0('0x4')+_0x72d30b[_0x4ee0('0x17')]['type']});_0x255c42['_bindAnnotationToEditors'](_0x1cf409,_0x1940e8),_0x5d61ed[_0x4ee0('0x1f')](_0x1940e8),_0x36a63c[_0x4ee0('0x46')](_0x1940e8);}[_0x4ee0('0x3e')](_0x195488){const _0x44db2b=this[_0x4ee0('0x2e')][_0x4ee0('0x5d')][_0x4ee0('0x39')](_0x4ee0('0x3a')),_0x119bc6=this[_0x4ee0('0x2e')][_0x4ee0('0x5d')]['get'](_0x4ee0('0x38')),_0x2e4b18=this['_suggestionToController'][_0x4ee0('0x39')](_0x195488),_0x3d1b52=_0x2e4b18[_0x4ee0('0x17')],_0x2dd69c=_0x119bc6[_0x4ee0('0x61')](_0x3d1b52);_0x44db2b[_0x4ee0('0x5e')](_0x3d1b52),_0x2dd69c&&_0x119bc6['remove'](_0x2dd69c),this[_0x4ee0('0xe')][_0x4ee0('0x10')](_0x195488),this['_viewToController'][_0x4ee0('0x10')](_0x3d1b52),_0x2e4b18[_0x4ee0('0x8')]();}[_0x4ee0('0x18')](_0x27df8a){if(!_0x27df8a[_0x4ee0('0x65')]||!this[_0x4ee0('0xe')][_0x4ee0('0x2d')](_0x27df8a))return;const _0x164afa=this[_0x4ee0('0x2e')][_0x4ee0('0x5d')][_0x4ee0('0x39')]('TrackChangesEditing'),_0x56d3f=this[_0x4ee0('0xe')][_0x4ee0('0x39')](_0x27df8a),_0x36277c=_0x27df8a[_0x4ee0('0x47')]();_0x56d3f[_0x4ee0('0x17')][_0x4ee0('0x2a')]=_0x164afa[_0x4ee0('0x43')][_0x4ee0('0x5a')](_0x36277c);}[_0x4ee0('0x8')](){for(const _0x23a002 of this[_0x4ee0('0xe')][_0x4ee0('0x40')]())this['_destroyController'](_0x23a002);for(const _0x2cc824 of this['_annotationViews']['values']())_0x2cc824[_0x4ee0('0x5c')][_0x4ee0('0x8')]();super[_0x4ee0('0x8')]();}}