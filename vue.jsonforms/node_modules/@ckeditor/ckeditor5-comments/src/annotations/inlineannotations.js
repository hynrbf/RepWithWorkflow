/*
 *             Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x3062=['detach','has','_balloon','afterInit','refresh','_manuallyClosed','hasView','view','annotations','context','includes','push','getByView','_getBalloonTargetForAnnotation','_removeAnnotationFromBalloon','blur','addObserver','pluginName','update','showStack','selection','destroy','remove','top','InlineAnnotations','width','isActive','updatePosition','target','document','_addedAnnotations','register','change:height','isFocused','left','hasActive','Esc','editableElement','isAttached','editing','viewRangeToDom','plugins','right','bottom','domConverter','_closeAnnotation','getBoundingClientRect','getOrderedSelectedAnnotations','activeAnnotation','editor','get','focus','inline','getFirstRange','inlineannotations-not-allowed-with-context','stopListening','_addAnnotationToBalloon','setActiveAnnotation','listenTo','keystrokes','_selectedAnnotations','every','collapse','clear','from','focusTracker','delete','_forceRefresh','set','visibleView','_setSelectedAnnotations','add','mousedown','map','length'];(function(_0x3bb77b,_0x306234){const _0xee37e2=function(_0x592ba0){while(--_0x592ba0){_0x3bb77b['push'](_0x3bb77b['shift']());}};_0xee37e2(++_0x306234);}(_0x3062,0x15f));const _0xee37=function(_0x3bb77b,_0x306234){_0x3bb77b=_0x3bb77b-0x0;let _0xee37e2=_0x3062[_0x3bb77b];return _0xee37e2;};import{Plugin as _0x272301}from'ckeditor5/src/core';import _0x4b2f7e from'./annotationsuis';import _0xe224c from'./editorannotations';import{ContextualBalloon as _0x23392f}from'ckeditor5/src/ui';import{MouseObserver as _0x5b12c7}from'ckeditor5/src/engine';import{CKEditorError as _0x4ca5ac,Rect as _0x1dda66}from'ckeditor5/src/utils';import'./../../theme/annotation-inline.css';export default class c extends _0x272301{static get['requires'](){return[_0xe224c,_0x23392f,_0x4b2f7e];}static get[_0xee37('0x29')](){return _0xee37('0x30');}constructor(_0x4aedc9){super(_0x4aedc9),_0x4aedc9[_0xee37('0x3f')][_0xee37('0x1f')][_0xee37('0x28')](_0x5b12c7),this[_0xee37('0x3e')]=!0x1,this['set'](_0xee37('0x48'),null),this[_0xee37('0x20')]=null,this[_0xee37('0x1d')]=new Set(),this['_balloon']=_0x4aedc9['plugins'][_0xee37('0x4a')](_0x23392f),this['_addedAnnotations']=new Set(),this['_selectedAnnotations']=[],this[_0xee37('0x10')]=!0x1;}['init'](){const _0x48d949=this[_0xee37('0x49')]['plugins'][_0xee37('0x4a')](_0x4b2f7e);_0x48d949[_0xee37('0x21')]===this[_0xee37('0x49')]&&(_0x48d949[_0xee37('0x37')]('inline',this),this['editor'][_0xee37('0x8')][_0xee37('0x11')](_0xee37('0x3c'),(_0x79dff3,_0xf9473a)=>{const _0xc9d00f=this[_0xee37('0x1a')];if(this[_0xee37('0x3e')]&&_0xc9d00f['visibleView']){const _0x27aa03=this['annotations'][_0xee37('0x24')](_0xc9d00f[_0xee37('0x12')]);_0x27aa03&&this[_0xee37('0x45')](_0x27aa03),_0xf9473a();}}));}[_0xee37('0x1b')](){const _0x1db671=this[_0xee37('0x49')][_0xee37('0x41')][_0xee37('0x4a')](_0x4b2f7e);_0x1db671['context']===this[_0xee37('0x49')]&&(_0x1db671[_0xee37('0x3b')]()||_0x1db671['switchTo'](_0xee37('0x1')));}[_0xee37('0x6')](_0x15b977){_0x15b977!==this[_0xee37('0x48')]&&(this[_0xee37('0x48')]&&(this['activeAnnotation'][_0xee37('0x32')]=!0x1),_0x15b977&&this[_0xee37('0x49')]['ui'][_0xee37('0xe')]['isFocused']&&(this[_0xee37('0x20')][_0xee37('0x19')](_0x15b977)&&this[_0xee37('0x5')](_0x15b977,!0x0),_0x15b977[_0xee37('0x32')]=!0x0),_0x15b977||this[_0xee37('0x13')]([]),this[_0xee37('0x48')]=_0x15b977);}['attach'](_0x3aa636){this['annotations']=_0x3aa636;const _0xd9533c=this[_0xee37('0x49')][_0xee37('0x41')][_0xee37('0x4a')](_0x4b2f7e),_0x31bc57=this[_0xee37('0x1a')];if(this[_0xee37('0x3e')])throw new _0x4ca5ac('inlineannotations-attach-already-attached',this);if(_0xd9533c[_0xee37('0x21')]!==this[_0xee37('0x49')])throw new _0x4ca5ac(_0xee37('0x3'),this);const _0x19e3a4=this[_0xee37('0x49')][_0xee37('0x41')][_0xee37('0x4a')](_0xe224c);this['listenTo'](_0x19e3a4,_0xee37('0x1c'),()=>{const _0x4b98a3=_0x19e3a4[_0xee37('0x47')]({'annotations':this[_0xee37('0x20')],'activeAnnotation':this[_0xee37('0x48')]});var _0x425035,_0x5a597b;!this[_0xee37('0x10')]&&(_0x425035=_0x4b98a3,_0x5a597b=this[_0xee37('0x9')],_0x425035[_0xee37('0x17')]===_0x5a597b[_0xee37('0x17')]&&_0x425035[_0xee37('0xa')](_0x22078a=>_0x5a597b[_0xee37('0x22')](_0x22078a)))||(this[_0xee37('0x10')]=!0x1,this[_0xee37('0x13')](_0x4b98a3),this[_0xee37('0x6')](_0x4b98a3[0x0]||null));}),this[_0xee37('0x7')](_0x19e3a4,_0xee37('0x27'),(_0x20a37d,{isAnnotationTracked:_0x2cb3b9})=>{this[_0xee37('0x48')]&&_0x2cb3b9(this[_0xee37('0x48')])&&(this['_setSelectedAnnotations']([]),this[_0xee37('0x6')](null));}),this['listenTo'](this['editor']['ui']['focusTracker'],'change:isFocused',(_0x1cc82d,_0x34acdf,_0x2a2f0c)=>{_0x2a2f0c||this[_0xee37('0x6')](null);}),this[_0xee37('0x7')](_0x3aa636,'remove',(_0x7087e,_0x45995e)=>{this['_removeAnnotationFromBalloon'](_0x45995e),_0x45995e===this['activeAnnotation']&&this[_0xee37('0x6')](null);}),this[_0xee37('0x7')](_0x31bc57,'change:visibleView',(_0x2988d5,_0x2ffe4d,_0x5a7c15,_0x33a6b3)=>{_0x33a6b3&&this[_0xee37('0x4')](_0x33a6b3);const _0x4477dc=_0x3aa636[_0xee37('0x24')](_0x5a7c15);_0x5a7c15&&_0x4477dc&&(this['listenTo'](_0x5a7c15,_0xee37('0x38'),()=>{_0x31bc57[_0xee37('0x33')]();}),this[_0xee37('0x7')](_0x5a7c15,_0xee37('0x3c'),()=>{this['_closeAnnotation'](_0x4477dc),this[_0xee37('0x49')][_0xee37('0x3f')]['view'][_0xee37('0x0')]();}),this['activeAnnotation']!==_0x4477dc&&this[_0xee37('0x6')](_0x4477dc));}),this[_0xee37('0x7')](this['editor']['ui'],_0xee37('0x2a'),()=>{_0x31bc57[_0xee37('0x12')]&&(_0x3aa636[_0xee37('0x24')](_0x31bc57[_0xee37('0x12')])&&_0x31bc57[_0xee37('0x33')]());}),this[_0xee37('0x7')](this[_0xee37('0x49')][_0xee37('0x3f')]['view'][_0xee37('0x35')],_0xee37('0x15'),()=>{this[_0xee37('0x10')]=!0x0,this[_0xee37('0x1d')][_0xee37('0xc')]();}),this[_0xee37('0x49')]['editing'][_0xee37('0x1f')][_0xee37('0x35')][_0xee37('0x2c')][_0xee37('0x3d')]&&this['editor'][_0xee37('0x3f')][_0xee37('0x1f')][_0xee37('0x0')](),this[_0xee37('0x3e')]=!0x0;}[_0xee37('0x18')](){if(!this['isAttached'])throw new _0x4ca5ac('inlineannotations-detach-not-attached',this);this['setActiveAnnotation'](null);for(const _0x5ec1a0 of this['_addedAnnotations'])this[_0xee37('0x26')](_0x5ec1a0);this[_0xee37('0x4')](),this[_0xee37('0x3e')]=!0x1,this[_0xee37('0x20')]=null;}[_0xee37('0x2d')](){this[_0xee37('0x3e')]&&this[_0xee37('0x18')]();}[_0xee37('0x13')](_0x5ba391){for(const _0x12a492 of this[_0xee37('0x9')])_0x5ba391[_0xee37('0x22')](_0x12a492)||this[_0xee37('0x1d')][_0xee37('0xf')](_0x12a492);for(const _0x1dc0cb of this['annotations'])_0x5ba391[_0xee37('0x22')](_0x1dc0cb)||this[_0xee37('0x26')](_0x1dc0cb);if(this[_0xee37('0x49')]['ui'][_0xee37('0xe')][_0xee37('0x39')])for(const _0x40ee02 of _0x5ba391)this['_addAnnotationToBalloon'](_0x40ee02);this[_0xee37('0x9')]=_0x5ba391;}[_0xee37('0x5')](_0x5e1eb6,_0x199c3c=!0x1){this['_manuallyClosed'][_0xee37('0x19')](_0x5e1eb6)||(this[_0xee37('0x36')][_0xee37('0x19')](_0x5e1eb6)||this[_0xee37('0x1a')][_0xee37('0x1e')](_0x5e1eb6['view'])||(this[_0xee37('0x36')][_0xee37('0x14')](_0x5e1eb6),this['_balloon'][_0xee37('0x14')]({'stackId':_0x5e1eb6[_0xee37('0x1f')]['id'],'view':_0x5e1eb6[_0xee37('0x1f')],'position':{'target':()=>this[_0xee37('0x25')](_0x5e1eb6)}})),_0x199c3c&&this[_0xee37('0x1a')][_0xee37('0x2b')](_0x5e1eb6[_0xee37('0x1f')]['id']));}['_getBalloonTargetForAnnotation'](_0x4dc0fd){const _0x227344=_0x4dc0fd[_0xee37('0x34')],_0x48d5ab=this['editor'][_0xee37('0x3f')][_0xee37('0x1f')],_0x185b14=_0x48d5ab[_0xee37('0x35')][_0xee37('0x2c')][_0xee37('0x2')](),_0x3998ec=_0x48d5ab[_0xee37('0x44')][_0xee37('0x40')](_0x185b14);if(_0x3998ec[_0xee37('0xb')](!0x0),_0x227344){if(_0x227344 instanceof _0x1dda66)return _0x227344;let _0x382a10=[];for(const _0x4d22ef of _0x227344)_0x382a10[_0xee37('0x23')](...(_0x48e515=_0x4d22ef['getClientRects'](),Array[_0xee37('0xd')](_0x48e515)[_0xee37('0x16')](DOMRect['fromRect'])));_0x382a10=function(_0xf8e937){const _0x14bc6f=[];let _0x5a6b58=_0xf8e937[0x0];for(let _0x21bf5a=0x1;_0x21bf5a<_0xf8e937['length'];_0x21bf5a++)F(_0x5a6b58,_0xf8e937[_0x21bf5a])?_0x5a6b58[_0xee37('0x31')]+=_0xf8e937[_0x21bf5a][_0xee37('0x31')]:(_0x14bc6f['push'](_0x5a6b58),_0x5a6b58=_0xf8e937[_0x21bf5a]);return _0x14bc6f[_0xee37('0x23')](_0x5a6b58),_0x14bc6f;}(_0x382a10);const _0x33ea9a=_0x3998ec[_0xee37('0x46')]();return _0x382a10['find'](_0x29ed0d=>_0x29ed0d[_0xee37('0x2f')]<=_0x33ea9a['top']&&_0x29ed0d[_0xee37('0x43')]>=_0x33ea9a[_0xee37('0x43')]&&_0x29ed0d[_0xee37('0x3a')]<=_0x33ea9a['left']&&_0x29ed0d[_0xee37('0x42')]>=_0x33ea9a[_0xee37('0x42')])||_0x382a10[0x0];}var _0x48e515;return _0x4dc0fd['targetRect']||_0x3998ec;}[_0xee37('0x26')](_0xd02a71){this['_addedAnnotations'][_0xee37('0x19')](_0xd02a71)&&this['_balloon'][_0xee37('0x1e')](_0xd02a71[_0xee37('0x1f')])&&(this[_0xee37('0x36')][_0xee37('0xf')](_0xd02a71),this['_balloon'][_0xee37('0x2e')](_0xd02a71[_0xee37('0x1f')]));}[_0xee37('0x45')](_0x1ea8e1){this[_0xee37('0x1d')][_0xee37('0x14')](_0x1ea8e1),this[_0xee37('0x26')](_0x1ea8e1);}}function F(_0x4f5480,_0x35ba30){return _0x4f5480[_0xee37('0x2f')]===_0x35ba30['top']&&_0x4f5480[_0xee37('0x43')]===_0x35ba30['bottom']&&_0x4f5480[_0xee37('0x42')]===_0x35ba30['left'];}