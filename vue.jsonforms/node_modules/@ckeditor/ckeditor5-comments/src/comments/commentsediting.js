/*
 *             Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x5841=['openNewCommentThread','reopenCommentThread','reconvertMarker','updateMarker','dataToMarker','change','map','registerAnnotation','addCommentThread','scrollToThreadMarker','isThreadsLoadingPaused','getRange','getWalker','change:isReadOnly','isResolved','view','$marker','refreshVisibility','activeMarker','length','end','addMarker:','split','hasDomSelection','conversion','getCommentThreads','ck-comment-marker--active','isObject','elementToElement','change:activeMarker','state','_threadToController','_autoResolvedThreads','focus','text','_detachCommentThread','newRange','hasMarkerForId','model','removeCommentThread','requires','delete','set','ck-comment-marker','render','listenTo','get','destroy','getByInnerView','plugins','enqueueChange','once','schema','_handleMarkerAddAndRemove','$textProxy','ready','differ','push','has','_attachResolvedThread','_initializeMarkerConverters','_getTextContext','start','_reconvertMarkers','resolveCommentThread','fetchCommentThread','getCommentThread','markers','rootName','commands','data','markerName','low','from','upcast','_removedThread','getChangedMarkers','registerPostFixer','substring','isEqual','config','editing','_attachMarkerToThread','collaboration.channelId','removeMarker:','filter','item','getAllMarkersForId','editor','dataDowncast','createPositionBefore','comment','consumable','createRange','_getTargetForId','isCollapsed','size','attachTo','ignoreResolvedComments','removeMarker','_attachedThreads','_hasTargetInContent','add','getAttribute','pluginName','setContext','root','_handleThreadMarker','for','reopen','document','CommentsEditing'];(function(_0x1a19bf,_0x5841f5){const _0x244f1c=function(_0x52948e){while(--_0x52948e){_0x1a19bf['push'](_0x1a19bf['shift']());}};_0x244f1c(++_0x5841f5);}(_0x5841,0xd1));const _0x244f=function(_0x1a19bf,_0x5841f5){_0x1a19bf=_0x1a19bf-0x0;let _0x244f1c=_0x5841[_0x1a19bf];return _0x244f1c;};import{Plugin as _0x31951f}from'ckeditor5/src/core';import{scrollViewportToShowTarget as _0x51ebf4}from'ckeditor5/src/utils';import _0x433bac from'./commentsrepository';import _0xfd7580 from'./addcommentthreadcommand';import{getAllMarkersDomElementsSorted as _0x1e8424}from'ckeditor5-collaboration/src/collaboration-core';import _0x3f90b7 from'../annotations/editorannotations';import _0x1f3e51 from'./integrations/commentsrestrictededitingmode';import'../../theme/commentmarker.css';import _0x4d67a6 from'./integrations/importword';import _0x1d19e6 from'../annotations/annotations';export default class r extends _0x31951f{static get[_0x244f('0x37')](){return[_0x433bac,_0x3f90b7,_0x1f3e51,_0x4d67a6];}static get[_0x244f('0x7')](){return _0x244f('0xe');}constructor(_0x35fecf){super(_0x35fecf),this[_0x244f('0x5a')]=null,this[_0x244f('0x2f')]=new Set(),this[_0x244f('0x39')](_0x244f('0x19'),!0x0),_0x35fecf['data']['once'](_0x244f('0x46'),()=>this[_0x244f('0x19')]=!0x1),this[_0x244f('0x39')](_0x244f('0x21'),null),this['on'](_0x244f('0x2c'),(_0x16bfe8,_0x58ef6c,_0x36e0df,_0x2f18ba)=>{const _0x21243a=_0x36e0df?tt(_0x36e0df)['id']:null;if(_0x35fecf[_0x244f('0x35')][_0x244f('0x14')](()=>{if(_0x21243a){const _0x193407=this['getAllMarkersForId'](_0x21243a);for(const _0x5d81f5 of _0x193407)_0x35fecf[_0x244f('0x60')]['reconvertMarker'](_0x5d81f5);}if(_0x2f18ba){const {id:_0xbbb7c2}=tt(_0x2f18ba),_0x16a3b8=this[_0x244f('0x66')](_0xbbb7c2);for(const _0x21c5b5 of _0x16a3b8)_0x35fecf['editing'][_0x244f('0x11')](_0x21c5b5);}}),_0x21243a){const _0x595fef=_0x35fecf[_0x244f('0x40')][_0x244f('0x3d')](_0x433bac)[_0x244f('0x51')](_0x21243a);_0x595fef&&_0x595fef[_0x244f('0x1d')]&&this[_0x244f('0x18')](_0x21243a);}}),this['_attachedThreads']=new Map();}['init'](){const _0x147f3b=this[_0x244f('0x67')],_0x503c4d=_0x147f3b['plugins'][_0x244f('0x3d')](_0x433bac),_0x78e89=_0x147f3b[_0x244f('0x5f')][_0x244f('0x3d')]('collaboration.channelId');_0x147f3b[_0x244f('0x54')][_0x244f('0x5')](_0x244f('0x17'),new _0xfd7580(_0x147f3b)),this[_0x244f('0x3c')](_0x147f3b,_0x244f('0x1c'),(_0x410885,_0x3d8a3c,_0x364590)=>{_0x503c4d['switchReadOnly'](_0x364590,_0x147f3b[_0x244f('0x5f')][_0x244f('0x3d')](_0x244f('0x62')));}),this[_0x244f('0x3c')](_0x503c4d,Z('addCommentThread',_0x78e89),(_0xb6dc84,{threadId:_0x4501bf})=>{const _0x3141ef=this[_0x244f('0x67')][_0x244f('0x40')][_0x244f('0x3d')](_0x433bac)[_0x244f('0x51')](_0x4501bf);_0x3141ef&&_0x3141ef[_0x244f('0x1d')]&&this[_0x244f('0x4a')](_0x4501bf);}),this[_0x244f('0x3c')](_0x503c4d,Z(_0x244f('0x36'),_0x78e89),(_0x23afad,{threadId:_0x310ea5})=>{_0x147f3b[_0x244f('0x35')]['enqueueChange']({'isUndoable':!0x1},_0x442f28=>{const _0x416a89=this[_0x244f('0x66')](_0x310ea5);this['_attachedThreads']['delete'](_0x310ea5),this[_0x244f('0x5a')]=_0x310ea5;for(const _0x1fe859 of _0x416a89)_0x442f28['removeMarker'](_0x1fe859);}),this[_0x244f('0x5a')]=null;},{'priority':'high'}),this[_0x244f('0x3c')](_0x503c4d,Z(_0x244f('0x4f'),_0x78e89),(_0x58c309,{threadId:_0xf4e753})=>{this[_0x244f('0x4a')](_0xf4e753),this['_reconvertMarkers'](_0xf4e753),this[_0x244f('0x67')]['editing'][_0x244f('0x1e')][_0x244f('0x26')]&&this[_0x244f('0x67')][_0x244f('0x60')][_0x244f('0x1e')][_0x244f('0x30')]();},{'priority':_0x244f('0x57')}),this[_0x244f('0x3c')](_0x503c4d,Z(_0x244f('0x10'),_0x78e89),(_0x54e4b5,{threadId:_0x51bfc6})=>{this[_0x244f('0x4e')](_0x51bfc6);},{'priority':'low'}),this[_0x244f('0x3c')](_0x503c4d,Z('addComment',_0x78e89),(_0x2669e6,{threadId:_0xffc33e,isFromAdapter:_0x52dbdb})=>{const _0x22cc8a=this['getAllMarkersForId'](_0xffc33e);if(_0x52dbdb||0x0==_0x22cc8a['length']||!_0x503c4d['hasCommentThread'](_0xffc33e))return;0x1===_0x503c4d[_0x244f('0x51')](_0xffc33e)[_0x244f('0x22')]&&_0x147f3b['model'][_0x244f('0x41')]({'isUndoable':!0x1},_0x3ad920=>{for(const _0x43c031 of _0x22cc8a)_0x3ad920['updateMarker'](_0x43c031,{'usingOperation':!0x0,'affectsData':!0x0});});},{'priority':_0x244f('0x57')}),this[_0x244f('0x4b')](),this[_0x244f('0x44')]();}[_0x244f('0x3e')](){const _0x31589a=this[_0x244f('0x67')][_0x244f('0x40')][_0x244f('0x3d')](_0x433bac),_0x51fb27=this[_0x244f('0x67')][_0x244f('0x5f')][_0x244f('0x3d')](_0x244f('0x62'));for(const _0x258fc5 of _0x31589a[_0x244f('0x28')]({'channelId':_0x51fb27}))_0x31589a[_0x244f('0x32')](_0x258fc5['id']),_0x31589a['_threads']['delete'](_0x258fc5['id']);super['destroy']();}['hasMarkerForId'](_0x41b9ab){return this[_0x244f('0x66')](_0x41b9ab)[_0x244f('0x22')]>0x0;}[_0x244f('0x66')](_0x43a93c){return Array[_0x244f('0x58')](this[_0x244f('0x3')][_0x244f('0x3d')](_0x43a93c)||[])[_0x244f('0x15')](_0xe7bb98=>this['editor']['model'][_0x244f('0x52')][_0x244f('0x3d')](_0xe7bb98))[_0x244f('0x64')](_0x572c01=>_0x572c01);}[_0x244f('0x18')](_0xcc88ce){const _0x52ff8d=this['_getTargetForId'](_0xcc88ce);_0x52ff8d&&setTimeout(()=>{this[_0x244f('0x21')]&&tt(this[_0x244f('0x21')])['id']===_0xcc88ce&&_0x51ebf4({'target':_0x52ff8d[0x0],'viewportOffset':0x64,'alignToTop':!0x0});},0x32);}[_0x244f('0x4e')](_0x119637){this[_0x244f('0x67')]['model'][_0x244f('0x14')](()=>{for(const _0x394ab3 of this['getAllMarkersForId'](_0x119637))this[_0x244f('0x67')][_0x244f('0x60')][_0x244f('0x11')](_0x394ab3);});}['_attachResolvedThread'](_0x33a4f9){const _0x504fe1=this[_0x244f('0x67')][_0x244f('0x40')][_0x244f('0x3d')](_0x433bac),_0x3ba2de=this[_0x244f('0x67')][_0x244f('0x40')][_0x244f('0x3d')](_0x3f90b7),_0x16a7f1=_0x504fe1[_0x244f('0x51')](_0x33a4f9);if(!this[_0x244f('0x3')][_0x244f('0x49')](_0x33a4f9)){const _0x54e1d0=_0x16a7f1[_0x244f('0x0')](()=>this[_0x244f('0x6d')](_0x16a7f1['id']));_0x3ba2de[_0x244f('0x16')](_0x54e1d0),this['_attachedThreads'][_0x244f('0x39')](_0x33a4f9,new Set()),_0x16a7f1[_0x244f('0x4')]=!0x1;}}['_initializeMarkerConverters'](){const _0x2aeabc=this[_0x244f('0x67')];_0x2aeabc[_0x244f('0x27')]['for']('editingDowncast')['markerToHighlight']({'model':'comment','view':(_0x15a99f,_0x795dad)=>{const {id:_0x45caa1}=tt(_0x15a99f[_0x244f('0x56')]),_0xe5dad1=_0x2aeabc[_0x244f('0x40')]['get'](_0x433bac)[_0x244f('0x51')](_0x45caa1),_0x5a729a=this[_0x244f('0x21')]&&tt(this[_0x244f('0x21')])['id']===_0x45caa1;if(_0xe5dad1&&_0xe5dad1['isResolved']&&!_0x5a729a&&_0x15a99f[_0x244f('0x65')])return _0x795dad['consumable']['consume'](_0x15a99f[_0x244f('0x65')],_0x244f('0x24')+_0x15a99f[_0x244f('0x56')]),_0x795dad[_0x244f('0x6b')]['consume'](_0x15a99f['item'],_0x244f('0x63')+_0x15a99f['markerName']),{'classes':[]};const _0x159eec=[_0x244f('0x3a')];return _0x5a729a&&_0x159eec[_0x244f('0x48')](_0x244f('0x29')),{'classes':_0x159eec,'attributes':{'data-comment':_0x45caa1}};}}),_0x2aeabc[_0x244f('0x27')][_0x244f('0xb')](_0x244f('0x68'))['markerToData']({'model':_0x244f('0x6a'),'view':(_0xd3e8ca,{options:_0x2aa960})=>{const _0x3825b9=_0x2aeabc['plugins'][_0x244f('0x3d')](_0x433bac),_0x29844e=_0x2aeabc[_0x244f('0x35')][_0x244f('0x52')][_0x244f('0x3d')](_0xd3e8ca),{id:_0x1b6af7,part:_0x45d7a1}=tt(_0xd3e8ca);if(_0x29844e&&!_0x29844e['affectsData'])return null;if(_0x2aa960[_0x244f('0x1')]){const _0x43d1ea=_0x3825b9[_0x244f('0x51')](_0x1b6af7);if(_0x43d1ea&&_0x43d1ea[_0x244f('0x1d')])return null;}return{'group':_0x244f('0x6a'),'name':_0x45d7a1?_0x1b6af7+':'+_0x45d7a1:_0x1b6af7};}}),_0x2aeabc[_0x244f('0x27')][_0x244f('0xb')](_0x244f('0x59'))[_0x244f('0x2b')]({'view':{'name':'comment','attributes':{'id':/^\w/}},'model':(_0x577679,{writer:_0x414a1a})=>_0x414a1a['createElement'](_0x244f('0x1f'),{'data-name':'comment:'+_0x577679[_0x244f('0x6')]('id')})}),_0x2aeabc['conversion'][_0x244f('0xb')](_0x244f('0x59'))[_0x244f('0x13')]({'view':'comment'});}[_0x244f('0x44')](){const _0x150c2d=this[_0x244f('0x67')],_0x447c37=_0x150c2d['plugins']['get'](_0x433bac),_0x5426ef=new Set(),_0x28a9a5=new Set();_0x150c2d['model'][_0x244f('0xd')][_0x244f('0x5c')](_0x113b0e=>{let _0x2b7358=!0x1;for(const {name:_0x3aa681,data:_0x3a857c}of _0x150c2d['model'][_0x244f('0xd')][_0x244f('0x47')][_0x244f('0x5b')]()){const {group:_0x10571a,id:_0x256a35}=tt(_0x3aa681);let _0x1b85d=_0x3a857c[_0x244f('0x33')];if(_0x244f('0x6a')!==_0x10571a||!_0x1b85d)continue;const _0x46c671='$graveyard'===_0x1b85d[_0x244f('0x9')][_0x244f('0x53')];_0x46c671||(_0x1b85d=ot(_0x1b85d,_0x150c2d[_0x244f('0x35')]),!_0x1b85d||_0x1b85d[_0x244f('0x6e')]||!_0x3a857c[_0x244f('0x33')]||_0x1b85d[_0x244f('0x5e')](_0x3a857c['newRange']))?_0x150c2d[_0x244f('0x35')]['hasContent'](_0x1b85d)&&!_0x46c671?this[_0x244f('0x19')]?_0x5426ef[_0x244f('0x5')](_0x3aa681):this[_0x244f('0xa')](_0x3aa681,_0x256a35):(_0x28a9a5[_0x244f('0x5')](_0x3aa681),_0x5426ef[_0x244f('0x38')](_0x3aa681),_0x113b0e[_0x244f('0x2')](_0x3aa681),_0x2b7358=!0x0):(_0x113b0e[_0x244f('0x12')](_0x3aa681,{'range':_0x1b85d}),_0x2b7358=!0x0);}return _0x2b7358;}),this['on']('change:isThreadsLoadingPaused',(_0x4109a1,_0x297c7e,_0x3c1f57)=>{if(!_0x3c1f57&&_0x5426ef[_0x244f('0x6f')])for(const _0x27d131 of _0x5426ef){const {id:_0x260f33}=tt(_0x27d131);_0x5426ef[_0x244f('0x38')](_0x27d131),_0x150c2d[_0x244f('0x35')][_0x244f('0x52')][_0x244f('0x3d')](_0x27d131)&&this[_0x244f('0xa')](_0x27d131,_0x260f33);}}),this[_0x244f('0x3c')](_0x150c2d[_0x244f('0x35')][_0x244f('0xd')],_0x244f('0x14'),(_0x376568,_0x212f11)=>{for(const {name:_0x539d10,data:{newRange:_0x475c86}}of _0x150c2d[_0x244f('0x35')][_0x244f('0xd')][_0x244f('0x47')][_0x244f('0x5b')]()){const {group:_0x2f9009,id:_0x3efd0f}=tt(_0x539d10);if(_0x244f('0x6a')!==_0x2f9009)continue;const _0x480f06=_0x447c37[_0x244f('0x51')](_0x3efd0f),_0x1e260a=this['hasMarkerForId'](_0x3efd0f);_0x480f06&&(_0x480f06[_0x244f('0x4')]||_0x150c2d[_0x244f('0x60')][_0x244f('0x1e')]['once'](_0x244f('0x3b'),()=>{const _0x25e18d=_0x150c2d[_0x244f('0x40')][_0x244f('0x3d')](_0x1d19e6),_0x105bfb=_0x447c37[_0x244f('0x2e')][_0x244f('0x3d')](_0x480f06)['view'];_0x25e18d[_0x244f('0x3f')](_0x105bfb)[_0x244f('0x20')]();},{'priority':_0x244f('0x57')}),_0x480f06[_0x244f('0x4')]=_0x1e260a||!!_0x475c86),_0x475c86||(_0x28a9a5[_0x244f('0x5')](_0x539d10),_0x5426ef['delete'](_0x539d10),this[_0x244f('0x3')][_0x244f('0x49')](_0x3efd0f)&&this[_0x244f('0x3')]['get'](_0x3efd0f)[_0x244f('0x38')](_0x539d10));}if(_0x212f11['isLocal'])for(const _0x5ea3c6 of _0x28a9a5){const {id:_0x1cb4b5}=tt(_0x5ea3c6),_0x51de8f=_0x447c37[_0x244f('0x51')](_0x1cb4b5),_0x155671=this[_0x244f('0x34')](_0x1cb4b5);_0x5426ef[_0x244f('0x38')](_0x5ea3c6),!_0x51de8f||_0x155671||_0x51de8f[_0x244f('0x1d')]||this[_0x244f('0x5a')]===_0x1cb4b5||(this['_autoResolvedThreads'][_0x244f('0x5')](_0x51de8f),_0x51de8f['resolve']());}_0x28a9a5['clear']();});}[_0x244f('0x6d')](_0x3672ed){const _0x178451=this[_0x244f('0x67')],_0x1d74ad=this[_0x244f('0x66')](_0x3672ed);return _0x1e8424(_0x178451[_0x244f('0x60')],_0x1d74ad);}['_getTextContext'](_0x4ddb45){const _0x1a83fd=this[_0x244f('0x66')](_0x4ddb45);let _0x3f2d84='',_0x3666e8=!0x1;for(const _0x2e19e9 of _0x1a83fd){const _0x26ede0=_0x2e19e9[_0x244f('0x1a')]();for(const _0x4e21f4 of Array[_0x244f('0x58')](_0x26ede0['getItems']()))_0x4e21f4['is'](_0x244f('0x45'))?(_0x3f2d84&&_0x3666e8&&(_0x3f2d84+='\x20',_0x3666e8=!0x1),_0x3f2d84+=_0x4e21f4[_0x244f('0x55')]):_0x3666e8=!0x0;_0x3666e8=!0x0;}return _0x3f2d84[_0x244f('0x5d')](0x0,0x96);}['_attachMarkerToThread'](_0x4b0817,_0x351359){const _0xc21dac=this[_0x244f('0x67')],_0x10b073=_0xc21dac[_0x244f('0x40')][_0x244f('0x3d')](_0x433bac);let _0x19c68f=_0x10b073[_0x244f('0x51')](_0x351359);if(this[_0x244f('0x3')]['has'](_0x351359)){const _0xd3edcd=this[_0x244f('0x3')]['get'](_0x351359);_0xd3edcd[_0x244f('0x49')](_0x4b0817)||_0xd3edcd['add'](_0x4b0817);}const _0x4d551c=_0xc21dac['config'][_0x244f('0x3d')]('collaboration.channelId'),_0x20ed20=_0xc21dac[_0x244f('0x40')][_0x244f('0x3d')](_0x3f90b7);if(_0x19c68f&&_0x19c68f[_0x244f('0x1d')]&&this[_0x244f('0x2f')][_0x244f('0x49')](_0x19c68f)&&(this[_0x244f('0x2f')][_0x244f('0x38')](_0x19c68f),_0x19c68f[_0x244f('0xc')]()),this[_0x244f('0x3')]['has'](_0x351359))return _0x19c68f;return this[_0x244f('0x3')][_0x244f('0x39')](_0x351359,new Set([_0x4b0817])),(!this['getAllMarkersForId'](_0x351359)[0x0]['managedUsingOperations']?_0xc21dac['editing'][_0x244f('0x1e')][_0x244f('0x42')](_0x244f('0x3b'),()=>{const _0x7ea96=_0xc21dac['plugins'][_0x244f('0x3d')](_0x1d19e6);_0x19c68f=_0x10b073[_0x244f('0xf')]({'channelId':_0x4d551c,'threadId':_0x351359,'target':()=>this[_0x244f('0x6d')](_0x351359),'context':{'type':'text','value':this[_0x244f('0x4c')](_0x351359)}});const _0x4c2a8b=_0x10b073[_0x244f('0x2e')][_0x244f('0x3d')](_0x19c68f)[_0x244f('0x1e')],_0x4df5de=_0x7ea96[_0x244f('0x3f')](_0x4c2a8b);_0x4df5de&&_0x20ed20[_0x244f('0x16')](_0x4df5de);},{'priority':'low'}):_0x10b073[_0x244f('0x50')]({'channelId':_0x4d551c,'threadId':_0x351359})['then'](_0x315a90=>{if('destroyed'!==_0xc21dac[_0x244f('0x2d')]){if(_0x19c68f=_0x315a90,_0x19c68f){const _0x19f1a4=_0x19c68f[_0x244f('0x0')](()=>this[_0x244f('0x6d')](_0x351359));_0x20ed20[_0x244f('0x16')](_0x19f1a4),_0x19c68f[_0x244f('0x1d')]&&this['_reconvertMarkers'](_0x351359);}else{const _0x42e32d=this[_0x244f('0x66')](_0x351359);_0xc21dac[_0x244f('0x35')][_0x244f('0x14')](_0x38454c=>{for(const _0x17d56c of _0x42e32d)_0x38454c[_0x244f('0x2')](_0x17d56c);});}}}),_0x19c68f);}[_0x244f('0xa')](_0x36d267,_0x2c5f37){const _0x276c85=this[_0x244f('0x61')](_0x36d267,_0x2c5f37);_0x276c85&&!_0x276c85['context']&&_0x276c85[_0x244f('0x8')]({'type':_0x244f('0x31'),'value':this[_0x244f('0x4c')](_0x2c5f37)});}}function Z(_0x1e399c,_0x246f3e){return _0x246f3e?_0x1e399c+':'+_0x246f3e:_0x1e399c;}function tt(_0x3d3f58){const _0x5c38b9=_0x3d3f58[_0x244f('0x25')](':');return{'group':_0x5c38b9[0x0],'id':_0x5c38b9[0x1],'part':_0x5c38b9[0x2]};}function ot(_0x4065c8,_0x5a74e4){const _0x1bce91=_0x5a74e4[_0x244f('0x43')],_0x13d69e=_0x5a74e4[_0x244f('0x6c')](_0x4065c8[_0x244f('0x4d')]);for(const _0x97b363 of _0x4065c8[_0x244f('0x1b')]()){const {type:_0x5f0b3f,item:_0x548e0a,nextPosition:_0x4b7611}=_0x97b363;if(_0x244f('0x31')===_0x5f0b3f||_0x1bce91[_0x244f('0x2a')](_0x548e0a)){const _0x2775a8=_0x5a74e4[_0x244f('0x69')](_0x548e0a);_0x13d69e[_0x244f('0x6e')]&&(_0x13d69e[_0x244f('0x4d')]=_0x2775a8),_0x13d69e[_0x244f('0x23')]=_0x4b7611;}}return _0x13d69e;}